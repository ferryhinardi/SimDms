(function(n){"use strict";function t(n,t,i,r,u){var e=this,f,o;this.errorMessages=u;this.scope=n;this.element=t;this.ngModel=r;this.attrs=i;o=function(n){var t=n;i.$observe(t,function(n){e.errorMessages[t.substring(3,t.length).toLowerCase()]=n})};for(f in i)i.hasOwnProperty(f)&&f.indexOf("msg")===0&&o(f);this.ngModel.$parsers.unshift(function(n){return n===""?null:n});n.$watch(function(){return r.$error},function(){r.$dirty?e.showErrors():e.resetValidity()},!0)}if(t.prototype.setDirty=function(n){this.ngModel.$dirty=n;this.ngModel.$pristine=!n;this.element.toggleClass("ng-dirty",n).toggleClass("ng-pristine",!n)},t.prototype.showErrors=function(t){var i=this.ngModel,u,e,f,o;if(this.setDirty(!0),i.$valid)this.resetValidity();else{var r="",s=0,h={minlength:this.attrs.ngMinlength,maxlength:this.attrs.ngMaxlength,min:this.attrs.min,max:this.attrs.max};for(u in i.$error)if(e=u.toLowerCase(),u!="required"&&i.$error[u]===!0&&this.errorMessages[e]){s++;f=this.errorMessages[e]+"";for(o in h)f=f.replace("{{"+o+"}}",h[o]);r+=f+"<br>"}s===0&&i.$error.required===!0&&(r+=this.errorMessages.required+"<br>");i.$error.messages!==undefined&&(r+=i.$error.messages);this.element.addClass("xt-error");this.attrs.tooltipElement&&(this.element=n.element(document.getElementById(this.attrs.tooltipElement)),this.element.addClass("xt-error-container"));this.tooltipSet===!0&&this.element.tooltip("destroy");this.element.tooltip({html:!0,title:r,placement:this.attrs.placement||"bottom",trigger:this.attrs.trigger||"focus hover",container:this.attrs.container||"body"});this.profile!=="showAll"&&t||this.element.tooltip("show");this.tooltipSet=!0}},t.prototype.resetValidity=function(){var n=this;setTimeout(function(){n.tooltipSet&&(n.ngModel.$error.messages=undefined,n.element.removeClass("xt-error"),n.element.tooltip("destroy"),n.tooltipSet=!1,n.scope.$apply())})},!n.isFunction(n.element.prototype.tooltip))throw new Error("xtform requires a jquery tooltip plugin, like bootstrap.js");n.module("xtForm",[]).provider("xtFormErrors",function(){var t={minlength:"Needs to be at least {{minlength}} characters long",maxlength:"Can be no longer than {{maxlength}} characters long",required:"This field is required",number:"Must be a number",min:"Must be at least {{min}}",max:"Must be no greater than {{max}}",email:"Invalid Email",pattern:"Illegal value"};this.setErrors=function(i){n.extend(t,i)};this.$get=function(){return t}}).directive("xtForm",["$parse","xtFormErrors",function(){return{require:["form","xtForm"],controller:["$scope","$element","$attrs",function(t,i,r){this.validators={_validators:{},registerValidator:function(n,t){t.profile=r.profile||"default";this._validators[n]=t},deregisterValidator:function(n){this._validators[n].ngModel.$valid=!0;this._validators[n].showErrors();delete this._validators[n]},hasValidator:function(n){return this._validators[n]!==undefined},getValidator:function(n){return this._validators[n]},resetValidity:function(){n.forEach(this._validators,function(n){n.resetValidity(!1)})},showAllErrors:function(){n.forEach(this._validators,function(n){n.showErrors(!0)})}};this.$element=i}],link:function(n,t,i,r){function h(){if(e.$setDirty(),!e.$valid){f.validators.showAllErrors();u.onSubmit(!1);return}f.validators.resetValidity();u.onSubmit(!0)}function c(){return e.$setDirty(),e.$valid?!0:(f.validators.showAllErrors(),!1)}function l(){f.validators.resetValidity()}var u={onSubmit:function(){}},e=r[0],f=r[1],s,o;i.xtForm&&(s=n.$eval(i.xtForm),s!==undefined&&(u=s,o=this,u.submit=function(){h.apply(o,arguments)},u.reset=function(){l.apply(o,arguments)},u.validate=function(){c.apply(o,arguments)}));t.on("submit",function(n){return h(),n.preventDefault(),!1});t.on("$destroy",function(){f.$element=null;f.validators=null})}}}]).directive("xtValidate",["xtFormErrors",function(i){return{require:["ngModel","^xtForm","^form"],priority:99,link:function(r,u,f,e){var s=e[0],o=e[1],c=n.copy(i),h;if(s.$name===undefined)throw new Error('element must have a "name" attribute to use xtValidate');u[0].nodeName.toUpperCase()==="SELECT"&&f.placement===undefined&&(f.placement="top");h=new t(r,u,f,s,c);o.validators.registerValidator(f.name,h);u.on("$destroy",function(){o&&o.validators&&o.validators.hasValidator(f.name)&&o.validators.deregisterValidator(f.name)})}}}])})(window.angular);