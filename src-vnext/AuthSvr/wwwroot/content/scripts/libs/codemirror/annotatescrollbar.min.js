(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";function t(n,t){function r(n){clearTimeout(i.doRedraw);i.doRedraw=setTimeout(function(){i.redraw()},n)}this.cm=n;this.options=t;this.buttonHeight=t.scrollButtonHeight||n.getOption("scrollButtonHeight");this.annotations=[];this.doRedraw=this.doUpdate=null;this.div=n.getWrapperElement().appendChild(document.createElement("div"));this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none";this.computeScale();var i=this;n.on("refresh",this.resizeHandler=function(){clearTimeout(i.doUpdate);i.doUpdate=setTimeout(function(){i.computeScale()&&r(20)},100)});n.on("markerAdded",this.resizeHandler);n.on("markerCleared",this.resizeHandler);if(t.listenForChanges!==!1)n.on("change",this.changeHandler=function(){r(250)})}n.defineExtension("annotateScrollbar",function(n){return typeof n=="string"&&(n={className:n}),new t(this,n)});n.defineOption("scrollButtonHeight",0);t.prototype.computeScale=function(){var n=this.cm,t=(n.getWrapperElement().clientHeight-n.display.barHeight-this.buttonHeight*2)/n.heightAtLine(n.lastLine()+1,"local");if(t!=this.hScale)return this.hScale=t,!0};t.prototype.update=function(n){this.annotations=n;this.redraw()};t.prototype.redraw=function(n){function e(n,i){if(h!=n.line&&(h=n.line,f=t.getLineHandle(h)),y&&f.height>w)return t.charCoords(n,"local")[i?"top":"bottom"];var r=t.heightAtLine(f,"local");return r+(i?0:f.height)}var i,c,p,a;n!==!1&&this.computeScale();var t=this.cm,u=this.hScale,v=document.createDocumentFragment(),r=this.annotations,y=t.getOption("lineWrapping"),w=y&&t.defaultTextHeight()*1.5,h=null,f=null;if(t.display.barWidth)for(i=0;i<r.length;i++){for(var o=r[i],l=c||e(o.from,!0)*u,s=e(o.to,!1)*u;i<r.length-1;){if(c=e(r[i+1].from,!0)*u,c>s+.9)break;o=r[++i];s=e(o.to,!1)*u}s!=l&&(p=Math.max(s-l,3),a=v.appendChild(document.createElement("div")),a.style.cssText="position: absolute; right: 0px; width: "+Math.max(t.display.barWidth-1,2)+"px; top: "+(l+this.buttonHeight)+"px; height: "+p+"px",a.className=this.options.className)}this.div.textContent="";this.div.appendChild(v)};t.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler);this.cm.off("markerAdded",this.resizeHandler);this.cm.off("markerCleared",this.resizeHandler);this.changeHandler&&this.cm.off("change",this.changeHandler);this.div.parentNode.removeChild(this.div)}});
//# sourceMappingURL=annotatescrollbar.min.js.map
