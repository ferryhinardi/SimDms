(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],n):n(CodeMirror)})(function(n){"use strict";function y(n,t){return typeof n=="string"?n=new RegExp(n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),t?"gi":"g"):n.global||(n=new RegExp(n.source,n.ignoreCase?"gi":"g")),{token:function(t){n.lastIndex=t.pos;var i=n.exec(t.string);if(i&&i.index==t.pos)return t.pos+=i[0].length,"searching";i?t.pos=i.index:t.skipToEnd()}}}function p(){this.posFrom=this.posTo=this.lastQuery=this.query=null;this.overlay=null}function r(n){return n.state.search||(n.state.search=new p)}function u(n){return typeof n=="string"&&n==n.toLowerCase()}function t(n,t,i){return n.getSearchCursor(t,i,u(t))}function w(n,t,r,u){n.openDialog(t,u,{value:r,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){i(n)}})}function e(n,t,i,r,u){n.openDialog?n.openDialog(t,u,{value:r,selectValueOnOpen:!0}):u(prompt(i,r))}function b(n,t,i,r){n.openConfirm?n.openConfirm(t,r):confirm(i)&&r[0]()}function s(n){return n.replace(/\\(.)/g,function(n,t){return t=="n"?"\n":t=="r"?"\r":t})}function h(n){var t=n.match(/^\/(.*)\/([a-z]*)$/);if(t)try{n=new RegExp(t[1],t[2].indexOf("i")==-1?"":"i")}catch(i){}else n=s(n);return(typeof n=="string"?n=="":n.test(""))&&(n=/x^/),n}function l(n,t,i){t.queryText=i;t.query=h(i);n.removeOverlay(t.overlay,u(t.query));t.overlay=y(t.query,u(t.query));n.addOverlay(t.overlay);n.showMatchesOnScrollbar&&(t.annotate&&(t.annotate.clear(),t.annotate=null),t.annotate=n.showMatchesOnScrollbar(t.query,u(t.query)))}function f(t,i,u){var f=r(t),h,s;if(f.query)return o(t,i);h=t.getSelection()||f.lastQuery;u&&t.openDialog?(s=null,w(t,c,h,function(i,r){(n.e_stop(r),i)&&(i!=f.queryText&&l(t,f,i),s&&(s.style.opacity=1),o(t,r.shiftKey,function(n,i){var r;i.line<3&&document.querySelector&&(r=t.display.wrapper.querySelector(".CodeMirror-dialog"))&&r.getBoundingClientRect().bottom-4>t.cursorCoords(i,"window").top&&((s=r).style.opacity=.4)}))})):e(t,c,"Search for:",h,function(n){n&&!f.query&&t.operation(function(){l(t,f,n);f.posFrom=f.posTo=t.getCursor();o(t,i)})})}function o(i,u,f){i.operation(function(){var o=r(i),e=t(i,o.query,u?o.posFrom:o.posTo);(e.find(u)||(e=t(i,o.query,u?n.Pos(i.lastLine()):n.Pos(i.firstLine(),0)),e.find(u)))&&(i.setSelection(e.from(),e.to()),i.scrollIntoView({from:e.from(),to:e.to()},20),o.posFrom=e.from(),o.posTo=e.to(),f&&f(e.from(),e.to()))})}function i(n){n.operation(function(){var t=r(n);(t.lastQuery=t.query,t.query)&&(t.query=t.queryText=null,n.removeOverlay(t.overlay),t.annotate&&(t.annotate.clear(),t.annotate=null))})}function a(n,i,r){n.operation(function(){for(var f,u=t(n,i);u.findNext();)typeof i!="string"?(f=n.getRange(u.from(),u.to()).match(i),u.replace(r.replace(/\$(\d)/g,function(n,t){return f[t]}))):u.replace(r)})}function v(n,u){if(!n.getOption("readOnly")){var o=n.getSelection()||r(n).lastQuery,f=u?"Replace all:":"Replace:";e(n,f+k,f,o,function(r){r&&(r=h(r),e(n,d,"Replace with:","",function(f){if(f=s(f),u)a(n,r,f);else{i(n);var e=t(n,r,n.getCursor()),o=function(){var i=e.from(),u;((u=e.findNext())||(e=t(n,r),(u=e.findNext())&&(!i||e.from().line!=i.line||e.from().ch!=i.ch)))&&(n.setSelection(e.from(),e.to()),n.scrollIntoView({from:e.from(),to:e.to()}),b(n,g,"Replace?",[function(){h(u)},o,function(){a(n,r,f)}]))},h=function(n){e.replace(typeof r=="string"?f:f.replace(/\$(\d)/g,function(t,i){return n[i]}));o()};o()}}))})}}var c='Search: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)<\/span>',k=' <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)<\/span>',d='With: <input type="text" style="width: 10em" class="CodeMirror-search-field"/>',g="Replace? <button>Yes<\/button> <button>No<\/button> <button>All<\/button> <button>Stop<\/button>";n.commands.find=function(n){i(n);f(n)};n.commands.findPersistent=function(n){i(n);f(n,!1,!0)};n.commands.findNext=f;n.commands.findPrev=function(n){f(n,!0)};n.commands.clearSearch=i;n.commands.replace=v;n.commands.replaceAll=function(n){v(n,!0)}});
//# sourceMappingURL=search.min.js.map
