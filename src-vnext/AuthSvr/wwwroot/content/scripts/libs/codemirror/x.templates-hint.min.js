(function(){function i(n,t){return n.slice(0,t.length).toUpperCase()==t.toUpperCase()}var n=[],t=CodeMirror.Pos;CodeMirror.templatesHint={};CodeMirror.templatesHint.getCompletions=function(r,u,f){function g(){this.marked=[];this.selectableMarkers=[];this.varIndex=-1}function nt(n,t){var r=n.findMarksAt(t.from),i,u;if(r)for(i=0;i<r.length;i++)if(u=r[i],u._templateVar)return u;return null}function w(n,t){var i=n._templateState,r,e,s,u,f,o;if(t.origin&&i&&!i.updating)try{if(i.updating=!0,r=nt(n,t),r==null)c(n);else for(e=r.find(),s=n.getRange(e.from,e.to),u=0;u<i.marked.length;u++)f=i.marked[u],f!=r&&f._templateVar==r._templateVar&&(o=f.find(),n.replaceRange(s,o.from,o.to))}finally{i.updating=!1}}function b(n){var i=n._templateState,r,f,e,u,t;if(i.selectableMarkers.length>0){for(i.varIndex++,i.varIndex>=i.selectableMarkers.length&&(i.varIndex=0),r=i.selectableMarkers[i.varIndex],f=r.find(),n.setSelection(f.from,f.to),e=r._templateVar,u=0;u<i.marked.length;u++)t=i.marked[u],t==r?(t.className="",t.startStyle="",t.endStyle=""):t._templateVar==r._templateVar?(t.className="CodeMirror3-templates-variable-selected",t.startStyle="",t.endStyle=""):(t.className="CodeMirror3-templates-variable",t.startStyle="CodeMirror3-templates-variable-start",t.endStyle="CodeMirror3-templates-variable-end");n.refresh()}}function k(n){for(var i,s,c,f=n.template,r=[],h=!1,e=null,t="",o=0,u=0;u<f.length;u++)i=f.charAt(u),i=="\n"?(t!=""&&r.push(t),t="",r.push(i),o=0,e=null):(s=!0,h?i=="}"&&(h=!1,s=!1,r.push({variable:t,x:o}),o+=t.length,t=""):i=="$"&&u+1<=f.length&&(u++,c=f.charAt(u),c=="{"&&(h=!0,s=!1,t!=""&&(r.push(t),o+=t.length),t="")),s&&e!="$"?(t+=i,e=i):e=null);return t!=""&&r.push(t),r}function d(n){return n=="cursor"||n=="line_selection"}function tt(n,i,r){var e,u,o,s,f;n._templateState&&c(n);e=new g;n._templateState=e;var it=r.template,y=k(it),l="",a=0,v=[],nt=[];for(f=0;f<y.length;f++)if(u=y[f],u.variable){if(!d(u.variable)){l+=u.variable;var o=t(i.from.line+a,i.from.ch+u.x),s=t(i.from.line+a,i.from.ch+u.x+u.variable.length),rt=nt[u.variable]!=!1;v.push({from:o,to:s,variable:u.variable,selectable:rt});nt[u.variable]=!1}}else l+=u,u=="\n"&&a++;for(o=i.from,s=i.to,n.replaceRange(l,o,s),f=0;f<v.length;f++){var h=v[f],o=h.from,s=h.to,tt=n.markText(o,s,{className:"CodeMirror3-templates-variable",startStyle:"CodeMirror3-templates-variable-start",endStyle:"CodeMirror3-templates-variable-end",inclusiveLeft:!0,inclusiveRight:!0,_templateVar:h.variable});e.marked.push(tt);h.selectable==!0&&e.selectableMarkers.push(tt)}b(n);n.on("change",w);n.addKeyMap(p)}function c(n){for(var t=n._templateState,i=0;i<t.marked.length;i++)t.marked[i].clear();t.marked.length=0;t.selectableMarkers.length=0;n.off("change",w);n.removeKeyMap(p);delete n._templateState}var p={Tab:b,Esc:c},it=r.doc.mode.name,l=n[it],s,a,h,e,v,y,o;if(l)for(s=0;s<l.length;s++)for(a=l[s].templates,h=0;h<a.length;h++)e=a[h],i(e.name,f)&&(v=e.name,e.description&&(v+="- "+e.description),y="CodeMirror3-hint-template",e.className&&(y=e.className),o={className:y,text:v,template:e},o.data=o,o.hint=function(n,t,i){tt(n,t,i)},o.info=function(n){for(var t,i,u="",e=k(n.template),f=0;f<e.length;f++)t=e[f],t.variable?d(t.variable)||(u+=t.variable):u+=t;return CodeMirror.runMode?(i=document.createElement("div"),i.className="cm-s-default",r.options&&r.options.theme&&(i.className="cm-s-"+r.options.theme),CodeMirror.runMode(u,r.getMode().name,i),i):u},u.push(o))};CodeMirror.templatesHint.addTemplates=function(t){var r=t.context,i;r&&(i=n[r],i||(i=[],n[r]=i),i.push(t))}})();