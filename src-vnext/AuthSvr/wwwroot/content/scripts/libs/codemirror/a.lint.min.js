(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";function h(t,i){function u(t){if(!r.parentNode)return n.off(document,"mousemove",u);r.style.top=Math.max(0,t.clientY-r.offsetHeight-5)+"px";r.style.left=t.clientX+5+"px"}var r=document.createElement("div");r.className="CodeMirror-lint-tooltip";r.appendChild(i.cloneNode(!0));document.body.appendChild(r);n.on(document,"mousemove",u);return u(t),r.style.opacity!=null&&(r.style.opacity=1),r}function i(n){n.parentNode&&n.parentNode.removeChild(n)}function c(n){n.parentNode&&(n.style.opacity==null&&i(n),n.style.opacity=0,setTimeout(function(){i(n)},600))}function r(t,i,r){function f(){n.off(r,"mouseout",f);u&&(c(u),u=null)}var u=h(t,i),e=setInterval(function(){if(u)for(var n=r;;n=n.parentNode){if(n==document.body)return;if(!n){f();break}}if(!u)return clearInterval(e)},400);n.on(r,"mouseout",f)}function l(n,t,i){this.marked=[];this.options=t;this.timeout=null;this.hasGutter=i;this.onMouseOver=function(t){b(n,t)}}function a(t,i){if(i instanceof Function)return{getAnnotations:i};if(i&&i!==!0||(i={}),i.getAnnotations||(i.getAnnotations=t.getHelper(n.Pos(0,0),"lint")),!i.getAnnotations)throw new Error("Required option 'getAnnotations' missing (lint addon)");return i}function u(n){var i=n.state.lint,r;for(i.hasGutter&&n.clearGutter(t),r=0;r<i.marked.length;++r)i.marked[r].clear();i.marked.length=0}function v(t,i,u,f){var e=document.createElement("div"),o=e;if(e.className="CodeMirror-lint-marker-"+i,u&&(o=e.appendChild(document.createElement("div")),o.className="CodeMirror-lint-marker-multiple"),f!=!1)n.on(o,"mouseover",function(n){r(n,t,o)});return e}function y(n,t){return n=="error"?n:t}function p(n){for(var r,u,t=[],i=0;i<n.length;++i)r=n[i],u=r.from.line,(t[u]||(t[u]=[])).push(r);return t}function f(n){var i=n.severity,t;return i||(i="error"),t=document.createElement("div"),t.className="CodeMirror-lint-message-"+i,t.appendChild(document.createTextNode(n.message)),t}function e(n){var r=n.state.lint,t=r.options,i=t.options||t;t.async?t.getAnnotations(n.getValue(),o,i,n):o(n,t.getAnnotations(n.getValue(),i,n))}function o(n,i){var o,s,l,b,a,r,h;u(n);var e=n.state.lint,c=e.options,w=p(i);for(o=0;o<w.length;++o)if(s=w[o],s){for(l=null,b=e.hasGutter&&document.createDocumentFragment(),a=0;a<s.length;++a)r=s[a],h=r.severity,h||(h="error"),l=y(l,h),c.formatAnnotation&&(r=c.formatAnnotation(r)),e.hasGutter&&b.appendChild(f(r)),r.to&&e.marked.push(n.markText(r.from,r.to,{className:"CodeMirror-lint-mark-"+h,__annotation:r}));e.hasGutter&&n.setGutterMarker(o,t,v(b,l,s.length>1,e.options.tooltips))}if(c.onUpdateLinting)c.onUpdateLinting(i,w,n)}function s(n){var t=n.state.lint;clearTimeout(t.timeout);t.timeout=setTimeout(function(){e(n)},t.options.delay||500)}function w(n,t){var i=t.target||t.srcElement;r(t,f(n),i)}function b(n,t){var f=t.target||t.srcElement,r,u;if(/\bCodeMirror-lint-mark-/.test(f.className)){var i=f.getBoundingClientRect(),o=(i.left+i.right)/2,s=(i.top+i.bottom)/2,e=n.findMarksAt(n.coordsChar({left:o,top:s},"client"));for(r=0;r<e.length;++r)if(u=e[r].__annotation,u)return w(u,t)}}var t="CodeMirror-lint-markers";n.defineOption("lint",!1,function(i,r,f){var h,c,o,v;if(f&&f!=n.Init&&(u(i),i.off("change",s),n.off(i.getWrapperElement(),"mouseover",i.state.lint.onMouseOver),delete i.state.lint),r){for(h=i.getOption("gutters"),c=!1,o=0;o<h.length;++o)h[o]==t&&(c=!0);v=i.state.lint=new l(i,a(i,r),c);i.on("change",s);if(v.options.tooltips!=!1)n.on(i.getWrapperElement(),"mouseover",v.onMouseOver);e(i)}})});