var modal,autoStart;if(SpeechRecognition=root.SpeechRecognition||root.webkitSpeechRecognition||root.mozSpeechRecognition||root.msSpeechRecognition||root.oSpeechRecognition,SpeechRecognition&&voice_command){$.root_.on("click",'[data-action="voiceCommand"]',function(n){$.root_.hasClass("voice-command-active")?$.speechApp.stop():($.speechApp.start(),$("#speech-btn .popover").fadeIn(350));n.preventDefault()});$(document).mouseup(function(n){$("#speech-btn .popover").is(n.target)||$("#speech-btn .popover").has(n.target).length!==0||$("#speech-btn .popover").fadeOut(250)});modal=$('<div class="modal fade" id="voiceModal" tabindex="-1" role="dialog" aria-labelledby="remoteModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><\/div><\/div><\/div>');modal.appendTo("body");debugState&&root.console.log("This browser supports Voice Command");$.speechApp=function(n){return n.start=function(){smartSpeechRecognition.addCommands(commands);smartSpeechRecognition?(smartSpeechRecognition.start(),$.root_.addClass("voice-command-active"),$.speechApp.playON(),voice_localStorage&&localStorage.setItem("sm-setautovoice","true")):alert("speech plugin not loaded")},n.stop=function(){smartSpeechRecognition&&(smartSpeechRecognition.abort(),$.root_.removeClass("voice-command-active"),$.speechApp.playOFF(),voice_localStorage&&localStorage.setItem("sm-setautovoice","false"),$("#speech-btn .popover").is(":visible")&&$("#speech-btn .popover").fadeOut(250))},n.playON=function(){var n=document.createElement("audio");navigator.userAgent.match("Firefox/")?n.setAttribute("src",$.sound_path+"voice_on.ogg"):n.setAttribute("src",$.sound_path+"voice_on.mp3");n.addEventListener("load",function(){n.play()},!0);$.sound_on&&(n.pause(),n.play())},n.playOFF=function(){var n=document.createElement("audio");navigator.userAgent.match("Firefox/")?n.setAttribute("src",$.sound_path+"voice_off.ogg"):n.setAttribute("src",$.sound_path+"voice_off.mp3");$.get();n.addEventListener("load",function(){n.play()},!0);$.sound_on&&(n.pause(),n.play())},n.playConfirmation=function(){var n=document.createElement("audio");navigator.userAgent.match("Firefox/")?n.setAttribute("src",$.sound_path+"voice_alert.ogg"):n.setAttribute("src",$.sound_path+"voice_alert.mp3");$.get();n.addEventListener("load",function(){n.play()},!0);$.sound_on&&(n.pause(),n.play())},n}({})}else $("#speech-btn").addClass("display-none");(function(n){"use strict";if(!SpeechRecognition)return root.smartSpeechRecognition=null,n;var i=[],t,r={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]},f,e=0,h=/\s*\((.*?)\)\s*/g,c=/(\(\?:[^)]+\))\?/g,l=/(\(\?)?:\w+/g,a=/\*\w+/g,v=/[\-{}\[\]+?.,\\\^$|#]/g,y=function(n){return n=n.replace(v,"\\$&").replace(h,"(?:$1)?").replace(l,function(n,t){return t?n:"([^\\s]+)"}).replace(a,"(.*?)").replace(c,"\\s*$1?\\s*"),new RegExp("^"+n+"$","i")},u=function(n){n.forEach(function(n){n.callback.apply(n.context)})},o=function(){s()||root.smartSpeechRecognition.init({},!1)},s=function(){return t!==n};root.smartSpeechRecognition={init:function(o,s){s=s===n?!0:!!s;t&&t.abort&&t.abort();t=new SpeechRecognition;t.maxAlternatives=5;t.continuous=!0;t.lang=voice_command_lang||"en-US";t.onstart=function(){u(r.start);debugState&&(root.console.log("%c ✔ SUCCESS: User allowed access the microphone service to start ",debugStyle_success),root.console.log("Language setting is set to: "+t.lang,debugStyle));$.root_.removeClass("service-not-allowed");$.root_.addClass("service-allowed")};t.onerror=function(n){u(r.error);switch(n.error){case"network":u(r.errorNetwork);break;case"not-allowed":case"service-not-allowed":f=!1;$.root_.removeClass("service-allowed");$.root_.addClass("service-not-allowed");debugState&&root.console.log("%c WARNING: Microphone was not detected (either user denied access or it is not installed properly) ",debugStyle_warning);(new Date).getTime()-e<200?u(r.errorPermissionBlocked):u(r.errorPermissionDenied)}};t.onend=function(){if(u(r.end),f){var n=(new Date).getTime()-e;n<1e3?setTimeout(root.smartSpeechRecognition.start,1e3-n):root.smartSpeechRecognition.start()}};t.onresult=function(n){var s,f,e,t,c,h,o,l;for(u(r.result),s=n.results[n.resultIndex],e=0;e<s.length;e++)for(f=s[e].transcript.trim(),debugState&&root.console.log("Speech recognized: %c"+f,debugStyle),t=0,c=i.length;t<c;t++)if(h=i[t].command.exec(f),h)return o=h.slice(1),debugState&&(root.console.log("command matched: %c"+i[t].originalPhrase,debugStyle),o.length&&root.console.log("with parameters",o)),i[t].callback.apply(this,o),u(r.resultMatch),l=["sound on","mute","stop"],l.indexOf(i[t].originalPhrase)<0&&($.smallBox({title:i[t].originalPhrase,content:"loading...",color:"#333",sound_file:"voice_alert",timeout:2e3}),$("#speech-btn .popover").is(":visible")&&$("#speech-btn .popover").fadeOut(250)),!0;return u(r.resultNoMatch),$.smallBox({title:'Error: <strong> " '+f+' " <\/strong> no match found!',content:"Please speak clearly into the microphone",color:"#a90329",timeout:5e3,icon:"fa fa-microphone"}),$("#speech-btn .popover").is(":visible")&&$("#speech-btn .popover").fadeOut(250),!1};s&&(i=[]);o.length&&this.addCommands(o)},start:function(i){o();i=i||{};f=i.autoRestart!==n?!!i.autoRestart:!0;e=(new Date).getTime();t.start()},abort:function(){f=!1;s&&t.abort()},debug:function(n){debugState=arguments.length>0?!!n:!0},setLanguage:function(n){o();t.lang=n},addCommands:function(n){var r,u,t;o();for(t in n)if(n.hasOwnProperty(t)){if(r=root[n[t]]||n[t],typeof r!="function")continue;u=y(t);i.push({command:u,callback:r,originalPhrase:t})}debugState&&root.console.log("Commands successfully loaded: %c"+i.length,debugStyle)},removeCommands:function(t){if(t===n){i=[];return}t=Array.isArray(t)?t:[t];i=i.filter(function(n){for(var i=0;i<t.length;i++)if(t[i]===n.originalPhrase)return!1;return!0})},addCallback:function(t,i,u){if(r[t]!==n){var f=root[i]||i;typeof f=="function"&&r[t].push({callback:f,context:u||this})}}}}).call(this);autoStart=function(){smartSpeechRecognition.addCommands(commands);smartSpeechRecognition?(smartSpeechRecognition.start(),$.root_.addClass("voice-command-active"),voice_localStorage&&localStorage.setItem("sm-setautovoice","true")):alert("speech plugin not loaded")};SpeechRecognition&&voice_command&&localStorage.getItem("sm-setautovoice")=="true"&&autoStart();SpeechRecognition&&voice_command_auto&&voice_command&&autoStart();