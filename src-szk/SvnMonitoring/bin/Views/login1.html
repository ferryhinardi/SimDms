<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Login</title>
		<link href="/css/bootstrap.min.css" rel="stylesheet" />    
		<link href="/css/font-awesome.min.css" rel="stylesheet" />    
		<link href="/themes/classic/ext-theme-classic-all.css" rel="stylesheet" />  
		
		<script src="/js/jquery-2.1.1.min.js"></script>  
		<script src="/js/ext-all.js"></script>  
		<script src="/js/bootstrap.min.js"></script>  
		<script src="/js/ext-theme-classic.js"></script>  
		<script src="/Scripts/Common.js"></script>
</head>
<body>
<div style="height:300px;width: 500px;">
    <div id="login-panel">

    </div>
</div>
<script type="text/javascript">
Ext.onReady(function(){
    Ext.QuickTips.init();

   new Ext.Panel({
       id           : "ext-panel",
       renderTo     : "login-panel",
       bodyStyle    : "background-color:aliceblue;",
       height       : 250,
       width        : 500,
       items        : [
           new Ext.FormPanel({
                id      : "login-form",
                bodyStyle : "background-color:transparent",
                style   : {
                    'padding-top': 80
                },
                border  : false,
                height  : 180,
                width   : 370,
                monitorValid : true,
                items   : [
                    new Ext.form.TextField({
                        id          : 'username',
                        name        : 'username',
                        fieldLabel  : 'UserName',
                        allowBlank  : false,
                        blankText   : 'Username is required.',
                        msgTarget   : 'side',
                        width       : 200
                    }),
                    new Ext.form.TextField({
                        id          : 'password',
                        name        : 'password',
                        inputType   : 'password',
                        fieldLabel  : 'PassworD',
                        blankText   : 'Password is required.',
                        allowBlank  : false,
                        msgTarget   : 'side',
                        width       : 200
                    })
                ],
                buttons:[
                    {
                       text : 'Login',
                       handler : function(){
                           authenticate(Ext.getCmp('username').getValue(),Ext.getCmp('password').getValue());
                       }
                    },
                    {
                       text : 'Reset',
                       handler : function(){
                           Ext.getCmp('login-form').getForm().reset();
                       }
                    }
                ]
           })
       ]
   });
});

function authenticate(u,p){
    var dataPanel = Ext.getCmp('ext-panel');
    Ext.Ajax.on('beforerequest',function(conn,o,result){
        dataPanel.getEl().mask('Authenticating...','x-mask-loading');
    });

    Ext.Ajax.on('requestcomplete',function(conn,o,result){
        dataPanel.getEl().unmask(true);
    });

    Ext.Ajax.on('requestexception',function(conn,o,result){
        dataPanel.getEl().unmask(true);
        Ext.MessageBox.show({
            title   : 'Message',
            msg     : '<div style="margin-top:5px;text-align:center;color:red;">Server Error</div>',
            width   : 300,
            buttons : Ext.MessageBox.OK,
            animEl  : 'ext-panel',
            iconCls : 'login-button-icon'
        });
    });

    Ext.Ajax.request({
        url : "Account/Login",
        method : "POST",
        params : {Password:p,UserName:u},
        callback : function(options,success,result){			
            var response = Ext.util.JSON.decode(result.responseText);
			console.log(response);
            if(!response.success){
                Ext.MessageBox.show({
                    title   : 'Message',
                    msg     : '<div style="margin-top:5px;text-align:center">' + response.reason + '</div>',
                    width   : 300,
                    buttons : Ext.MessageBox.OK,
                    animEl  : 'ext-panel',
                    iconCls : 'login-button-icon'
                });
            }else{
                Ext.MessageBox.show({
                    title   : 'Message',
                    msg     : '<div style="margin-top:5px;text-align:center">Login Successful</div>',
                    width   : 300,
                    buttons : Ext.MessageBox.OK,
                    animEl  : 'ext-panel',
                    iconCls : 'login-button-icon'
                });
				window.location = "/home";
            }
        }
    });
}
</script>
</body>
</html>
