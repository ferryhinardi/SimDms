/*!
 * Pikaday
 *
 * Copyright © 2014 David Bushell | BSD & MIT license | https://github.com/dbushell/Pikaday
 */
(function(n,t){"use strict";var i;if(typeof exports=="object"){try{i=require("moment")}catch(r){}module.exports=t(i)}else typeof define=="function"&&define.amd?define(function(n){try{i=n("moment")}catch(r){}return t(i)}):n.Pikaday=t(n.moment)})(this,function(n){"use strict";var e=typeof n=="function",c=!!window.addEventListener,i=window.document,s=window.setTimeout,u=function(n,t,i,r){c?n.addEventListener(t,i,!!r):n.attachEvent("on"+t,i)},f=function(n,t,i,r){c?n.removeEventListener(t,i,!!r):n.detachEvent("on"+t,i)},a=function(n,t,r){var u;i.createEvent?(u=i.createEvent("HTMLEvents"),u.initEvent(t,!0,!1),u=o(u,r),n.dispatchEvent(u)):i.createEventObject&&(u=i.createEventObject(),u=o(u,r),n.fireEvent("on"+t,u))},k=function(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")},r=function(n,t){return(" "+n.className+" ").indexOf(" "+t+" ")!==-1},d=function(n,t){r(n,t)||(n.className=n.className===""?t:n.className+" "+t)},g=function(n,t){n.className=k((" "+n.className+" ").replace(" "+t+" "," "))},l=function(n){return/Array/.test(Object.prototype.toString.call(n))},t=function(n){return/Date/.test(Object.prototype.toString.call(n))&&!isNaN(n.getTime())},nt=function(n){return n%4==0&&n%100!=0||n%400==0},tt=function(n,t){return[31,nt(n)?29:28,31,30,31,30,31,31,30,31,30,31][t]},h=function(n){t(n)&&n.setHours(0,0,0,0)},v=function(n,t){return n.getTime()===t.getTime()},o=function(n,i,r){var u,f;for(u in i)f=n[u]!==undefined,f&&typeof i[u]=="object"&&i[u]!==null&&i[u].nodeName===undefined?t(i[u])?r&&(n[u]=new Date(i[u].getTime())):l(i[u])?r&&(n[u]=i[u].slice(0)):n[u]=o({},i[u],r):(r||!f)&&(n[u]=i[u]);return n},y=function(n){return n.month<0&&(n.year-=Math.ceil(Math.abs(n.month)/12),n.month+=12),n.month>11&&(n.year+=Math.floor(Math.abs(n.month)/12),n.month-=12),n},p={field:null,bound:undefined,position:"bottom left",reposition:!0,format:"YYYY-MM-DD",defaultDate:null,setDefaultDate:!1,firstDay:0,minDate:null,maxDate:null,yearRange:10,showWeekNumber:!1,minYear:0,maxYear:9999,minMonth:undefined,maxMonth:undefined,isRTL:!1,yearSuffix:"",showMonthAfterYear:!1,numberOfMonths:1,mainCalendar:"left",container:undefined,i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},onSelect:null,onOpen:null,onClose:null,onDraw:null},w=function(n,t,i){for(t+=n.firstDay;t>=7;)t-=7;return i?n.i18n.weekdaysShort[t]:n.i18n.weekdays[t]},it=function(n,t,i,r,u,f,e){if(e)return'<td class="is-empty"><\/td>';var o=[];return f&&o.push("is-disabled"),u&&o.push("is-today"),r&&o.push("is-selected"),'<td data-day="'+n+'" class="'+o.join(" ")+'"><button class="pika-button pika-day" type="button" data-pika-year="'+i+'" data-pika-month="'+t+'" data-pika-day="'+n+'">'+n+"<\/button><\/td>"},rt=function(n,t,i){var r=new Date(i,0,1),u=Math.ceil(((new Date(i,t,n)-r)/864e5+r.getDay()+1)/7);return'<td class="pika-week">'+u+"<\/td>"},ut=function(n,t){return"<tr>"+(t?n.reverse():n).join("")+"<\/tr>"},ft=function(n){return"<tbody>"+n.join("")+"<\/tbody>"},et=function(n){var t,i=[];for(n.showWeekNumber&&i.push("<th><\/th>"),t=0;t<7;t++)i.push('<th scope="col"><abbr title="'+w(n,t)+'">'+w(n,t,!0)+"<\/abbr><\/th>");return"<thead>"+(n.isRTL?i.reverse():i).join("")+"<\/thead>"},ot=function(n,t,i,r,u){for(var h,f=n._o,v=i===f.minYear,y=i===f.maxYear,s='<div class="pika-title">',c,a,p=!0,w=!0,o=[],e=0;e<12;e++)o.push('<option value="'+(i===u?e-t:12+e-t)+'"'+(e===r?" selected":"")+(v&&e<f.minMonth||y&&e>f.maxMonth?"disabled":"")+">"+f.i18n.months[e]+"<\/option>");for(c='<div class="pika-label">'+f.i18n.months[r]+'<select class="pika-select pika-select-month">'+o.join("")+"<\/select><\/div>",l(f.yearRange)?(e=f.yearRange[0],h=f.yearRange[1]+1):(e=i-f.yearRange,h=1+i+f.yearRange),o=[];e<h&&e<=f.maxYear;e++)e>=f.minYear&&o.push('<option value="'+e+'"'+(e===i?" selected":"")+">"+e+"<\/option>");return a='<div class="pika-label">'+i+f.yearSuffix+'<select class="pika-select pika-select-year">'+o.join("")+"<\/select><\/div>",s+=f.showMonthAfterYear?a+c:c+a,v&&(r===0||f.minMonth>=r)&&(p=!1),y&&(r===11||f.maxMonth<=r)&&(w=!1),t===0&&(s+='<button class="pika-prev'+(p?"":" is-disabled")+'" type="button">'+f.i18n.previousMonth+"<\/button>"),t===n._o.numberOfMonths-1&&(s+='<button class="pika-next'+(w?"":" is-disabled")+'" type="button">'+f.i18n.nextMonth+"<\/button>"),s+"<\/div>"},st=function(n,t){return'<table cellpadding="0" cellspacing="0" class="pika-table">'+et(n)+ft(t)+"<\/table>"},b=function(f){var o=this,h=o.config(f),l;o._onMouseDown=function(n){if(o._v){n=n||window.event;var t=n.target||n.srcElement;if(t){if(!r(t,"is-disabled")){if(r(t,"pika-button")&&!r(t,"is-empty")){o.setDate(new Date(t.getAttribute("data-pika-year"),t.getAttribute("data-pika-month"),t.getAttribute("data-pika-day")));h.bound&&s(function(){o.hide();h.field&&h.field.blur()},100);return}r(t,"pika-prev")?o.prevMonth():r(t,"pika-next")&&o.nextMonth()}if(r(t,"pika-select"))o._c=!0;else if(n.preventDefault)n.preventDefault();else return n.returnValue=!1,!1}}};o._onChange=function(n){n=n||window.event;var t=n.target||n.srcElement;t&&(r(t,"pika-select-month")?o.gotoMonth(t.value):r(t,"pika-select-year")&&o.gotoYear(t.value))};o._onInputChange=function(i){var r;i.firedBy!==o&&(e?(r=n(h.field.value,h.format),r=r&&r.isValid()?r.toDate():null):r=new Date(Date.parse(h.field.value)),o.setDate(t(r)?r:null),o._v||o.show())};o._onInputFocus=function(){o.show()};o._onInputClick=function(){o.show()};o._onInputBlur=function(){o._c||(o._b=s(function(){o.hide()},50));o._c=!1};o._onClick=function(n){n=n||window.event;var t=n.target||n.srcElement,i=t;if(t){!c&&r(t,"pika-select")&&(t.onchange||(t.setAttribute("onchange","return;"),u(t,"change",o._onChange)));do if(i===h.trigger)return;while(i=i.parentNode);o._v&&i!==h.trigger&&o.hide()}};o.el=i.createElement("div");o.el.className="pika-single"+(h.isRTL?" is-rtl":"");u(o.el,"mousedown",o._onMouseDown,!0);u(o.el,"change",o._onChange);h.field&&(h.container?h.container.appendChild(o.el):h.bound?i.body.appendChild(o.el):h.field.parentNode.insertBefore(o.el,h.field.nextSibling),u(h.field,"change",o._onInputChange),h.defaultDate||(h.defaultDate=e&&h.field.value?n(h.field.value,h.format).toDate():new Date(Date.parse(h.field.value)),h.setDefaultDate=!0));l=h.defaultDate;t(l)?h.setDefaultDate?o.setDate(l,!0):o.gotoDate(l):o.gotoDate(new Date);h.bound?(this.hide(),o.el.className+=" is-bound",u(h.trigger,"click",o._onInputClick),u(h.trigger,"focus",o._onInputFocus),u(h.trigger,"blur",o._onInputBlur)):this.show()};return b.prototype={config:function(n){var i,r,u;return this._o||(this._o=o({},p,!0)),i=o(this._o,n,!0),i.isRTL=!!i.isRTL,i.field=i.field&&i.field.nodeName?i.field:null,i.bound=!!(i.bound!==undefined?i.field&&i.bound:i.field),i.trigger=i.trigger&&i.trigger.nodeName?i.trigger:i.field,r=parseInt(i.numberOfMonths,10)||1,i.numberOfMonths=r>4?4:r,t(i.minDate)||(i.minDate=!1),t(i.maxDate)||(i.maxDate=!1),i.minDate&&i.maxDate&&i.maxDate<i.minDate&&(i.maxDate=i.minDate=!1),i.minDate&&(h(i.minDate),i.minYear=i.minDate.getFullYear(),i.minMonth=i.minDate.getMonth()),i.maxDate&&(h(i.maxDate),i.maxYear=i.maxDate.getFullYear(),i.maxMonth=i.maxDate.getMonth()),l(i.yearRange)?(u=(new Date).getFullYear()-10,i.yearRange[0]=parseInt(i.yearRange[0],10)||u,i.yearRange[1]=parseInt(i.yearRange[1],10)||u):(i.yearRange=Math.abs(parseInt(i.yearRange,10))||p.yearRange,i.yearRange>100&&(i.yearRange=100)),i},toString:function(i){return t(this._d)?e?n(this._d).format(i||this._o.format):this._d.toDateString():""},getMoment:function(){return e?n(this._d):null},setMoment:function(t,i){e&&n.isMoment(t)&&this.setDate(t.toDate(),i)},getDate:function(){return t(this._d)?new Date(this._d.getTime()):null},setDate:function(n,i){if(!n)return this._d=null,this._o.field&&(this._o.field.value="",a(this._o.field,"change",{firedBy:this})),this.draw();if(typeof n=="string"&&(n=new Date(Date.parse(n))),t(n)){var r=this._o.minDate,u=this._o.maxDate;t(r)&&n<r?n=r:t(u)&&n>u&&(n=u);this._d=new Date(n.getTime());h(this._d);this.gotoDate(this._d);this._o.field&&(this._o.field.value=this.toString(),a(this._o.field,"change",{firedBy:this}));i||typeof this._o.onSelect!="function"||this._o.onSelect.call(this,this.getDate())}},gotoDate:function(n){var r=!0;if(t(n)){if(this.calendars){var f=new Date(this.calendars[0].year,this.calendars[0].month,1),i=new Date(this.calendars[this.calendars.length-1].year,this.calendars[this.calendars.length-1].month,1),u=n.getTime();i.setMonth(i.getMonth()+1);i.setDate(i.getDate()-1);r=u<f.getTime()||i.getTime()<u}r&&(this.calendars=[{month:n.getMonth(),year:n.getFullYear()}],this._o.mainCalendar==="right"&&(this.calendars[0].month+=1-this._o.numberOfMonths));this.adjustCalendars()}},adjustCalendars:function(){this.calendars[0]=y(this.calendars[0]);for(var n=1;n<this._o.numberOfMonths;n++)this.calendars[n]=y({month:this.calendars[0].month+n,year:this.calendars[0].year});this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(n){isNaN(n)||(this.calendars[0].month=parseInt(n,10),this.adjustCalendars())},nextMonth:function(){this.calendars[0].month++;this.adjustCalendars()},prevMonth:function(){this.calendars[0].month--;this.adjustCalendars()},gotoYear:function(n){isNaN(n)||(this.calendars[0].year=parseInt(n,10),this.adjustCalendars())},setMinDate:function(n){this._o.minDate=n},setMaxDate:function(n){this._o.maxDate=n},draw:function(n){var i,f;if(this._v||n){var t=this._o,e=t.minYear,o=t.maxYear,r=t.minMonth,u=t.maxMonth,h="";for(this._y<=e&&(this._y=e,!isNaN(r)&&this._m<r&&(this._m=r)),this._y>=o&&(this._y=o,!isNaN(u)&&this._m>u&&(this._m=u)),i=0;i<t.numberOfMonths;i++)h+='<div class="pika-lendar">'+ot(this,i,this.calendars[i].year,this.calendars[i].month,this.calendars[0].year)+this.render(this.calendars[i].year,this.calendars[i].month)+"<\/div>";this.el.innerHTML=h;t.bound&&t.field.type!=="hidden"&&s(function(){t.trigger.focus()},1);typeof this._o.onDraw=="function"&&(f=this,s(function(){f._o.onDraw.call(f)},0))}},adjustPosition:function(){if(!this._o.container){var r=this._o.trigger,u=r,f=this.el.offsetWidth,e=this.el.offsetHeight,s=window.innerWidth||i.documentElement.clientWidth,h=window.innerHeight||i.documentElement.clientHeight,c=window.pageYOffset||i.body.scrollTop||i.documentElement.scrollTop,n,t,o;if(typeof r.getBoundingClientRect=="function")o=r.getBoundingClientRect(),n=o.left+window.pageXOffset,t=o.bottom+window.pageYOffset;else for(n=u.offsetLeft,t=u.offsetTop+u.offsetHeight;u=u.offsetParent;)n+=u.offsetLeft,t+=u.offsetTop;(this._o.reposition&&n+f>s||this._o.position.indexOf("right")>-1&&n-f+r.offsetWidth>0)&&(n=n-f+r.offsetWidth);(this._o.reposition&&t+e>h+c||this._o.position.indexOf("top")>-1&&t-e-r.offsetHeight>0)&&(t=t-e-r.offsetHeight);this.el.style.cssText=["position: absolute","left: "+n+"px","top: "+t+"px"].join(";")}},render:function(n,i){var r=this._o,a=new Date,y=tt(n,i),u=new Date(n,i,1).getDay(),p=[],e=[],o,s,f,l;for(h(a),r.firstDay>0&&(u-=r.firstDay,u<0&&(u+=7)),o=y+u,s=o;s>7;)s-=7;for(o+=7-s,f=0,l=0;f<o;f++){var c=new Date(n,i,1+(f-u)),w=r.minDate&&c<r.minDate||r.maxDate&&c>r.maxDate,b=t(this._d)?v(c,this._d):!1,k=v(c,a),d=f<u||f>=y+u;e.push(it(1+(f-u),i,n,b,k,w,d));++l==7&&(r.showWeekNumber&&e.unshift(rt(f-u,i,n)),p.push(ut(e,r.isRTL)),e=[],l=0)}return st(r,p)},isVisible:function(){return this._v},show:function(){this._v||(g(this.el,"is-hidden"),this._v=!0,this.draw(),this._o.bound&&(u(i,"click",this._onClick),this.adjustPosition()),typeof this._o.onOpen=="function"&&this._o.onOpen.call(this))},hide:function(){var n=this._v;n!==!1&&(this._o.bound&&f(i,"click",this._onClick),this.el.style.cssText="",d(this.el,"is-hidden"),this._v=!1,n!==undefined&&typeof this._o.onClose=="function"&&this._o.onClose.call(this))},destroy:function(){this.hide();f(this.el,"mousedown",this._onMouseDown,!0);f(this.el,"change",this._onChange);this._o.field&&(f(this._o.field,"change",this._onInputChange),this._o.bound&&(f(this._o.trigger,"click",this._onInputClick),f(this._o.trigger,"focus",this._onInputFocus),f(this._o.trigger,"blur",this._onInputBlur)));this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},b}),function(n){"use strict";var t=n.editors.TextEditor.prototype.extend();t.prototype.prepare=function(t,i,r,u,f,e){n.editors.TextEditor.prototype.prepare.apply(this,arguments);this.options={};this.cellProperties.select2Options&&(this.options=$.extend(this.options,e.select2Options))};t.prototype.createElements=function(){this.$body=$(document.body);this.wtDom=n.Dom;this.TEXTAREA=document.createElement("input");this.TEXTAREA.setAttribute("type","text");this.$textarea=$(this.TEXTAREA);this.wtDom.addClass(this.TEXTAREA,"handsontableInput");this.textareaStyle=this.TEXTAREA.style;this.textareaStyle.width=0;this.textareaStyle.height=0;this.TEXTAREA_PARENT=document.createElement("DIV");this.wtDom.addClass(this.TEXTAREA_PARENT,"handsontableInputHolder");this.textareaParentStyle=this.TEXTAREA_PARENT.style;this.textareaParentStyle.top=0;this.textareaParentStyle.left=0;this.textareaParentStyle.display="none";this.TEXTAREA_PARENT.appendChild(this.TEXTAREA);this.instance.rootElement[0].appendChild(this.TEXTAREA_PARENT);var t=this;n.PluginHooks.add("afterRender",function(){t.instance.registerTimeout("refresh_editor_dimensions",function(){t.refreshDimensions()},0)})};var r=function(){this.close();this.finishEditing()},u=function(){this.close();this.finishEditing()},i=function(t){var o=this,i=o.getActiveEditor(),r=n.helper.keyCode,f=(t.ctrlKey||t.metaKey)&&!t.altKey,u,e;if(t.target===i.TEXTAREA&&!t.isImmediatePropagationStopped()){if(t.keyCode===17||t.keyCode===224||t.keyCode===91||t.keyCode===93){t.stopImmediatePropagation();return}switch(t.keyCode){case r.ENTER:u=i.instance.getSelected();e=!(u[0]===u[2]&&u[1]===u[3]);(f&&!e||t.altKey)&&(i.isOpened()?(i.val(i.val()+"\n"),i.focus()):i.beginEditing(i.originalValue+"\n"),t.stopImmediatePropagation());t.preventDefault();break;case r.A:case r.X:case r.C:case r.V:if(f){t.stopImmediatePropagation();break}case r.HOME:case r.END:t.stopImmediatePropagation()}}};t.prototype.open=function(){this.textareaParentStyle.display="block";this.instance.addHook("beforeKeyDown",i);this.$textarea.css({height:$(this.TD).height(),"min-width":$(this.TD).outerWidth()});this.$textarea.show();this.$textarea.offset($(this.TD).offset());var n=this;this.$textarea.select2(this.options).on("change",r.bind(this)).on("select2-close",u.bind(this)).on("select2-open",function(){var t=$(".select2-drop-active .select2-search .select2-input");t.val(n.$textarea.val()).trigger("paste")});setTimeout(function(){n.$textarea.select2("focus");n.$textarea.select2("container").find(".select2-choice").trigger("mousedown").trigger("mouseup")},50)};t.prototype.close=function(){this.instance.listen();this.instance.removeHook("beforeKeyDown",i);this.$textarea.off();this.$textarea.hide();n.editors.TextEditor.prototype.close.apply(this,arguments)};t.prototype.val=function(n){if(typeof n=="undefined")return this.$textarea.val();this.$textarea.val(n)};t.prototype.focus=function(){this.instance.listen()};t.prototype.beginEditing=function(){var t=this.instance.getSettings().onBeginEditing;t&&t()===!1||n.editors.TextEditor.prototype.beginEditing.apply(this,arguments)};t.prototype.finishEditing=function(){return this.instance.listen(),n.editors.TextEditor.prototype.finishEditing.apply(this,arguments)};n.editors.Select2Editor=t;n.editors.registerEditor("select2",t)}(Handsontable);