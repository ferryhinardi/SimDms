(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){function t(n,t,i,r){this.cm=n;this.node=t;this.options=i;this.height=r;this.cleared=!1}function i(n){var i=n.getWrapperElement(),f=window.getComputedStyle?window.getComputedStyle(i):i.currentStyle,r=parseInt(f.height),t=n.state.panels={setHeight:i.style.height,heightLeft:r,panels:0,wrapper:document.createElement("div")},u;i.parentNode.insertBefore(t.wrapper,i);u=n.hasFocus();t.wrapper.appendChild(i);u&&n.focus();n._setSize=n.setSize;r!=null&&(n.setSize=function(i,u){if(u==null)return this._setSize(i,u);if(t.setHeight=u,typeof u!="number"){var f=/^(\d+\.?\d*)px$/.exec(u);f?u=Number(f[1]):(t.wrapper.style.height=u,u=t.wrapper.offsetHeight,t.wrapper.style.height="")}n._setSize(i,t.heightLeft+=u-r);r=u})}function r(n){var t=n.state.panels,i;n.state.panels=null;i=n.getWrapperElement();t.wrapper.parentNode.replaceChild(i,t.wrapper);i.style.height=t.setHeight;n.setSize=n._setSize;n.setSize()}n.defineExtension("addPanel",function(n,r){var u,f;return this.state.panels||i(this),u=this.state.panels,r&&r.position=="bottom"?u.wrapper.appendChild(n):u.wrapper.insertBefore(n,u.wrapper.firstChild),f=r&&r.height||n.offsetHeight,this._setSize(null,u.heightLeft-=f),u.panels++,new t(this,n,r,f)});t.prototype.clear=function(){if(!this.cleared){this.cleared=!0;var n=this.cm.state.panels;this.cm._setSize(null,n.heightLeft+=this.height);n.wrapper.removeChild(this.node);--n.panels==0&&r(this.cm)}};t.prototype.changed=function(n){var t=n==null?this.node.offsetHeight:n,i=this.cm.state.panels;this.cm._setSize(null,i.height+=t-this.height);this.height=t}});