(function(){"use strict";function f(n,t){this.options=t}function e(n){if(n instanceof Function)return{getText:n};if(!n||!n.getText)throw new Error("Required option 'getText' missing (tern-extension addon)");return n}function o(n,t){var i=new XMLHttpRequest;i.open("get",n,!0);i.send();i.onreadystatechange=function(){i.readyState==4&&t(i.responseText,i.status)}}function s(n,t,i){var u=i.cm,r=u.state.ternExt;return r&&r.options.getText?r.options.getText(u):i.getValue()}function n(){return i==null&&(i=new CodeMirror.TernServer({defs:r,fileFilter:s,completionTip:function(n){return n.info?n.info(n):n.doc?n.doc:void 0}})),i}function u(n,t){return n.slice(0,t.length).toUpperCase()==t.toUpperCase()}function h(n){var s=n.name,i=n.type,r=null,e,o,c;if(u(i,"fn(")){for(var h=0,f=i.substring(2,i.length),t=0,t=0;t<f.length;t++)if(e=f.charAt(t),e=="("?h++:e==")"&&h--,s+=e,h==0)break;o=f.substring(t+1,f.length);c=o.lastIndexOf(" -> ");c!=-1&&(r=o.substring(c+4,o.length))}else r=i;return r&&(s+=" -> "+r),s}function c(n){var r=n.name,o=n.type,s=null,i=null,h=!1,t;if(u(o,"fn(")){r+="(";for(var f=0,c=o.substring(2,o.length),e=0,e=0;e<c.length;e++){t=c.charAt(e);switch(t){case"(":f++;break;case")":f--;break;default:f==1&&(h?t==","&&(h=!1):i==null?t!=" "&&t!="?"&&(i=t):t==":"?(h=!0,s==null?s=i:r+=", ",r+=i,i=null):t!=" "&&t!="?"&&(i+=t))}if(f==0)break}r+=")"}return{text:r,firstParam:s}}var i=null,r=[],t=CodeMirror.Pos;CodeMirror.tern={};CodeMirror.tern.addDef=function(n){typeof n=="string"?o(n,function(n){r.push(JSON.parse(n))}):r.push(n)};CodeMirror.ternHint=function(i,r){function u(n){for(var f,s,v,e=n.list,o=0;o<e.length;o++)f=e[o],s=h(f.data),f.displayText=s,f.text=null,f.hint=function(n,i,r){var s=t(i.from.line,i.from.ch),h=t(i.to.line,i.to.ch),e=r.data,o=c(e),u,f;n.replaceRange(o.text,s,h);u=o.firstParam;u!=null&&(f=e.name,n.setSelection(t(i.from.line,i.from.ch+f.length+1),t(i.to.line,i.from.ch+f.length+1+u.length)))};if(CodeMirror.templatesHint){var l=!0,u=n.from,y=n.to,a=i.getRange(u,y);a!=""||u.line==0&&u.ch==0||(v=i.getRange(t(u.line,u.ch-1),u),l=v!=".");l&&CodeMirror.templatesHint.getCompletions(i,e,a)}r(n)}var f=n(i);return f.getHint(i,u)};CodeMirror.tern.showType=function(t){var i=n(t);i.showType(t)};CodeMirror.tern.jumpToDef=function(t){var i=n(t);i.jumpToDef(t)};CodeMirror.tern.jumpBack=function(t){var i=n(t);i.jumpBack(t)};CodeMirror.tern.rename=function(t){var i=n(t);i.rename(t)};CodeMirror.tern.getServer=n;CodeMirror.defineOption("ternWith",!1,function(n,t,i){if(i&&i!=CodeMirror.Init&&delete n.state.ternExt,t)var r=n.state.ternExt=new f(n,e(t))})})();