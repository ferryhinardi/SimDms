(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript"),require("../css/css")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../xml/xml","../javascript/javascript","../css/css"],n):n(CodeMirror)})(function(n){"use strict";n.defineMode("htmlmixed",function(t,i){function h(n,t){var e=t.htmlState.tagName,s,i,h,f;if(e&&(e=e.toLowerCase()),s=r.token(n,t.htmlState),e=="script"&&/\btag\b/.test(s)&&n.current()==">"){for(i=n.string.slice(Math.max(0,n.pos-100),n.pos).match(/\btype\s*=\s*("[^"]+"|'[^']+'|\S+)[^<]*$/i),i=i?i[1]:"",i&&/[\"\']/.test(i.charAt(0))&&(i=i.slice(1,i.length-1)),h=0;h<u.length;++h)if(f=u[h],typeof f.matches=="string"?i==f.matches:f.matches.test(i)){f.mode&&(t.token=l,t.localMode=f.mode,t.localState=f.mode.startState&&f.mode.startState(r.indent(t.htmlState,"")));break}}else e=="style"&&/\btag\b/.test(s)&&n.current()==">"&&(t.token=a,t.localMode=o,t.localState=o.startState(r.indent(t.htmlState,"")));return s}function c(n,t,i){var r=n.current(),u=r.search(t),f;return u>-1?n.backUp(r.length-u):(f=r.match(/<\/?$/))&&(n.backUp(r.length),n.match(t,!1)||n.match(r)),i}function l(n,t){return n.match(/^<\/\s*script\s*>/i,!1)?(t.token=h,t.localState=t.localMode=null,null):c(n,/<\/\s*script\s*>/,t.localMode.token(n,t.localState))}function a(n,t){return n.match(/^<\/\s*style\s*>/i,!1)?(t.token=h,t.localState=t.localMode=null,null):c(n,/<\/\s*style\s*>/,o.token(n,t.localState))}var r=n.getMode(t,{name:"xml",htmlMode:!0,multilineTagIndentFactor:i.multilineTagIndentFactor,multilineTagIndentPastTag:i.multilineTagIndentPastTag}),o=n.getMode(t,"css"),u=[],s=i&&i.scriptTypes,f,e;if(u.push({matches:/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^$/i,mode:n.getMode(t,"javascript")}),s)for(f=0;f<s.length;++f)e=s[f],u.push({matches:e.matches,mode:e.mode&&n.getMode(t,e.mode)});return u.push({matches:/./,mode:n.getMode(t,"text/plain")}),{startState:function(){var n=r.startState();return{token:h,localMode:null,localState:null,htmlState:n}},copyState:function(t){if(t.localState)var i=n.copyState(t.localMode,t.localState);return{token:t.token,localMode:t.localMode,localState:i,htmlState:n.copyState(r,t.htmlState)}},token:function(n,t){return t.token(n,t)},indent:function(t,i){return!t.localMode||/^\s*<\//.test(i)?r.indent(t.htmlState,i):t.localMode.indent?t.localMode.indent(t.localState,i):n.Pass},innerMode:function(n){return{state:n.localState||n.htmlState,mode:n.localMode||r}}}},"xml","javascript","css");n.defineMIME("text/html","htmlmixed")});