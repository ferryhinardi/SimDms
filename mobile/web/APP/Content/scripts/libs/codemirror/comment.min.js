(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";function u(n){var t=n.search(i);return t==-1?0:t}var r={},i=/[^\s\u00a0]/,t=n.Pos;n.commands.toggleComment=function(n){for(var i,r,u=Infinity,o=n.listSelections(),f=null,e=o.length-1;e>=0;e--)(i=o[e].from(),r=o[e].to(),i.line>=u)||(r.line>=u&&(r=t(u,0)),u=i.line,f==null?n.uncomment(i,r)?f="un":(n.lineComment(i,r),f="line"):f=="un"?n.uncomment(i,r):n.lineComment(i,r))};n.defineExtension("lineComment",function(n,f,e){var s;e||(e=r);var o=this,c=o.getModeAt(n),h=e.lineComment||c.lineComment;if(!h){(e.blockCommentStart||c.blockCommentStart)&&(e.fullLines=!0,o.blockComment(n,f,e));return}if(s=o.getLine(n.line),s!=null){var l=Math.min(f.ch!=0||f.line==n.line?f.line+1:f.line,o.lastLine()+1),a=e.padding==null?" ":e.padding,v=e.commentBlankLines||n.line==f.line;o.operation(function(){var f,c,y,r;if(e.indent)for(f=s.slice(0,u(s)),r=n.line;r<l;++r)(c=o.getLine(r),y=f.length,v||i.test(c))&&(c.slice(0,y)!=f&&(y=u(c)),o.replaceRange(f+h+a,t(r,0),t(r,y)));else for(r=n.line;r<l;++r)(v||i.test(o.getLine(r)))&&o.replaceRange(h+a,t(r,0))})}});n.defineExtension("blockComment",function(n,u,f){var o,h;f||(f=r);var e=this,s=e.getModeAt(n),c=f.blockCommentStart||s.blockCommentStart,l=f.blockCommentEnd||s.blockCommentEnd;if(!c||!l){(f.lineComment||s.lineComment)&&f.fullLines!=!1&&e.lineComment(n,u,f);return}(o=Math.min(u.line,e.lastLine()),o!=n.line&&u.ch==0&&i.test(e.getLine(o))&&--o,h=f.padding==null?" ":f.padding,n.line>o)||e.operation(function(){var v,a,r;if(f.fullLines!=!1){if(v=i.test(e.getLine(o)),e.replaceRange(h+l,t(o)),e.replaceRange(c+h,t(n.line,0)),a=f.blockCommentLead||s.blockCommentLead,a!=null)for(r=n.line+1;r<=o;++r)(r!=o||v)&&e.replaceRange(a+h,t(r,0))}else e.replaceRange(l,u),e.replaceRange(c,n)})});n.defineExtension("uncomment",function(n,u,f){var a,k,v,y,c,p,w,rt;f||(f=r);var e=this,g=e.getModeAt(n),s=Math.min(u.ch!=0||u.line==n.line?u.line:u.line-1,e.lastLine()),h=Math.min(n.line,s),nt=f.lineComment||g.lineComment,ut=[],o=f.padding==null?" ":f.padding,ft;n:{if(!nt)break n;for(a=h;a<=s;++a){if(k=e.getLine(a),v=k.indexOf(nt),v>-1&&!/comment/.test(e.getTokenTypeAt(t(a,v+1)))&&(v=-1),v==-1&&(a!=s||a==h)&&i.test(k))break n;if(v>-1&&i.test(k.slice(0,v)))break n;ut.push(k)}if(e.operation(function(){for(var n=h;n<=s;++n){var u=ut[n-h],r=u.indexOf(nt),i=r+nt.length;r<0||(u.slice(i,i+o.length)==o&&(i+=o.length),ft=!0,e.replaceRange("",t(n,r),t(n,i)))}}),ft)return!0}if(y=f.blockCommentStart||g.blockCommentStart,c=f.blockCommentEnd||g.blockCommentEnd,!y||!c)return!1;var it=f.blockCommentLead||g.blockCommentLead,d=e.getLine(h),b=s==h?d:e.getLine(s),tt=d.indexOf(y),l=b.lastIndexOf(c);return(l==-1&&h!=s&&(b=e.getLine(--s),l=b.lastIndexOf(c)),tt==-1||l==-1||!/comment/.test(e.getTokenTypeAt(t(h,tt+1)))||!/comment/.test(e.getTokenTypeAt(t(s,l+1))))?!1:(p=d.lastIndexOf(y,n.ch),w=p==-1?-1:d.slice(0,n.ch).indexOf(c,p+y.length),p!=-1&&w!=-1&&w+c.length!=n.ch)?!1:(w=b.indexOf(c,u.ch),rt=b.slice(u.ch).lastIndexOf(y,w-u.ch),p=w==-1||rt==-1?-1:u.ch+rt,w!=-1&&p!=-1&&p!=u.ch)?!1:(e.operation(function(){var r,n,a,u,f;if(e.replaceRange("",t(s,l-(o&&b.slice(l-o.length,l)==o?o.length:0)),t(s,l+c.length)),r=tt+y.length,o&&d.slice(r,r+o.length)==o&&(r+=o.length),e.replaceRange("",t(h,tt),t(h,r)),it)for(n=h+1;n<=s;++n)(a=e.getLine(n),u=a.indexOf(it),u==-1||i.test(a.slice(0,u)))||(f=u+it.length,o&&a.slice(f,f+o.length)==o&&(f+=o.length),e.replaceRange("",t(n,u),t(n,f)))}),!0)})});