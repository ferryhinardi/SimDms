(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror"),require("../../mode/sql/sql")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],n):n(CodeMirror)})(function(n){"use strict";function h(t){var i=t.doc.modeOption;return i==="sql"&&(i="text/x-sql"),n.resolveMode(i).keywords}function c(n,t){var i=n.length,r=t.substr(0,i);return n.toUpperCase()===r.toUpperCase()}function i(n,t,i,r){for(var u in i)i.hasOwnProperty(u)&&(Array.isArray(i)&&(u=i[u]),c(t,u)&&n.push(r(u)))}function l(n,f,e,o){var y=f.string.charAt(0)=="`",s=f.string.substr(1),l=o.getTokenAt(t(n.line,f.start)),h,a,c;if(f.string.charAt(0)=="."||l.string=="."){if(l.string=="."&&(l=o.getTokenAt(t(n.line,f.start-1))),h=l.string,a=!1,h.match(/`/g)&&(a=!0,h=h.replace(/`/g,"")),r.hasOwnProperty(h)||(h=v(h,o)),c=r[h],!c)return;y?i(e,s,c,function(n){return"`"+n+"`"}):a?i(e,s,c,function(n){return".`"+n+"`"}):i(e,s,c,function(n){return"."+n})}else{while(f.start&&s.charAt(0)==".")f=o.getTokenAt(t(n.line,f.start-1)),s=f.string+s;y?(i(e,s,r,function(n){return"`"+n+"`"}),i(e,s,u,function(n){return"`"+n+"`"})):(i(e,s,r,function(n){return n}),i(e,s,u,function(n){return n}))}}function a(n,t){var u,r,i;if(n)for(u=/[,;]/g,r=n.split(" "),i=0;i<r.length;i++)t(r[i]?r[i].replace(u,""):"")}function o(n){return n.line+n.ch/Math.pow(10,6)}function s(n){return t(Math.floor(n),+n.toString().split(".").pop())}function v(n,i){for(var v=i.doc,d=v.getValue(),nt=n.toUpperCase(),y="",p="",f=[],w={start:t(0,0),end:t(i.lastLine(),i.getLineHandle(i.lastLine()).length)},h=d.indexOf(e.QUERY_DIV),c,b,l,k,u,g;h!=-1;)f.push(v.posFromIndex(h)),h=d.indexOf(e.QUERY_DIV,h+1);for(f.unshift(t(0,0)),f.push(t(i.lastLine(),i.getLineHandle(i.lastLine()).text.length)),c=0,b=o(i.getCursor()),u=0;u<f.length;u++){if(l=o(f[u]),b>c&&b<=l){w={start:s(c),end:s(l)};break}c=l}for(k=v.getRange(w.start,w.end,!1),u=0;u<k.length;u++)if(g=k[u],a(g,function(n){var t=n.toUpperCase();t===nt&&r.hasOwnProperty(y)&&(p=y);t!==e.ALIAS_KEYWORD&&(y=n)}),p)break;return p}var r,u,f,e={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},t=n.Pos;n.registerHelper("hint","sql",function(n,e){var v;r=e&&e.tables||{};v=e&&e.defaultTable;u=v&&r[v]||[];f=f||h(n);var s=n.getCursor(),a=[],o=n.getTokenAt(s),y,p,c;return o.end>s.ch&&(o.end=s.ch,o.string=o.string.slice(0,s.ch-o.start)),o.string.match(/^[.`\w@]\w*$/)?(c=o.string,y=o.start,p=o.end):(y=p=s.ch,c=""),c.charAt(0)=="."||c.charAt(0)=="`"?l(s,o,a,n):(i(a,c,r,function(n){return n}),i(a,c,u,function(n){return n}),i(a,c,f,function(n){return n.toUpperCase()})),{list:a,from:t(s.line,y),to:t(s.line,p)}})});