(function(){var t,i,n;i=function(){function n(n){var t=this;this.element=$("#cm-suggestions");this.element.length||this.create();this.element.delegate("option","click",function(i){return t.element[0].selectedIndex=i.target.index,n.insert()});$(document).unbind("click.completions").bind("click.completions",function(){return t.hide()})}return n.prototype.create=function(){return this.element=$("<select id='cm-suggestions'><\/select>"),$("body").append(this.element)},n.prototype.fill=function(n){var u,i,f,r,t,e;return r=function(){var i,o,r;for(r=[],i=0,o=n.length;i<o;i++)t=n[i],f=t.label||t.value||t,e=t.value||t,u=t.action||"",r.push("<option data-action='"+u+"' value='"+e+"'>"+f+"<\/option>");return r}(),i=this.element.html(r.join(""))[0],i.selectedIndex=0,i.size=Math.min(Math.max(2,r.length),10)},n.prototype.selected=function(){return this.element.val()},n.prototype.action=function(){var n;return n=this.element[0].selectedIndex,this.element.find("option").slice(n,n+1).data("action")},n.prototype.selectPrevious=function(){var n;return n=this.element[0],n.selectedIndex=n.selectedIndex<1?n.length-1:n.selectedIndex-1},n.prototype.selectNext=function(){return this.element[0].selectedIndex=(this.element[0].selectedIndex+1)%this.element[0].length},n.prototype.showAt=function(n){var t,i;return i={left:n.left,top:n.top},this.element.css(i),this.visible=!0,this.element.show(),t=this.element.outerHeight(),n.y+t>$(window).height()?this.element.css({top:n.y-this.element.outerHeight()-25}):void 0},n.prototype.hide=function(){return this.visible=!1,this.element.hide()},n.prototype._select=function(){},n}();n=function(n){return CodeMirror.keyNames[n.keyCode]};t=function(){function t(n,t){this.editor=n;this.mode=t;this.widget=new i(this)}return t.prototype.suggest=function(){var n=this.editor.getCursor(),t=this.editor.cursorCoords(n);return this.editor.somethingSelected()?this.widget.hide():(this.mode&&this.mode.hasHints(this.editor))?(this.hints=this.getHints(),this.hints?(this.widget.fill(this.hints.list),this.widget.showAt(t)):this.widget.hide()):this.widget.hide()},t.prototype.getHints=function(){var n;return(n=this.mode&&this.mode.getHints(this.editor),!(n&&n.list&&n.list.length))?null:n.list.length===1&&n.to.ch-n.from.ch===n.list[0].length?null:n},t.prototype.insert=function(){var n;if(this.widget.visible)return(n=this.widget.action())?this.mode&&this.mode[n](this.editor,this.widget.selected()):this.editor.replaceRange(this.widget.selected(),this.hints.from,this.hints.to),this.editor.focus()},t.prototype.autoQuote=function(n,t,i,r){var u,e,f,o;if(i||(i=t),r||(r=i),u=this.editor.getCursor(),this.editor.somethingSelected()){n.stop();f=this.editor.getSelection();f.indexOf(i)===0&&f.match(new RegExp("\\"+r+"$"))?this.editor.replaceSelection(f.substr(1,f.length-2)):this.editor.replaceSelection([i,this.editor.getSelection(),r].join(""));return}if(e=this.editor.getRange(u,{line:u.line,ch:u.ch+1}),t===r&&e===r&&(n.stop(),this.editor.setCursor(u.line,u.ch+1)),e.match(/^\s?$/))return(o=this.editor.getTokenAt(u),o.string.match(new RegExp(".+\\"+r+"$")))?(n.stop(),this.editor.setCursor(u.line,u.ch+1)):o.string.indexOf(r)===-1?(this.editor.replaceRange(r,u),this.editor.setCursor(u)):void 0},t.prototype.ignoreBracketIfClosed=function(n,t){var i,r;if(!this.editor.somethingSelected())return i=this.editor.getCursor(),r=this.editor.getRange(i,{line:i.line,ch:i.ch+1}),r===t?(n.stop(),this.editor.setCursor(i.line,i.ch+1)):void 0},t.prototype.keydown=function(t){var i=n(t);switch(i){case"Up":if(this.widget.visible)return this.widget.selectPrevious(),!0;break;case"Down":if(this.widget.visible)return this.widget.selectNext(),!0;break;case"Enter":case"Tab":if(this.widget.visible)return this.insert(),this.suggest(),t.stop(),!0;if(i==="Enter"&&this.mode&&this.mode.newline)return this.mode.newline(this.editor,t);break;case"Esc":if(this.widget.visible)return this.widget.hide(),!0}},t.prototype.keypress=function(n){switch(n.charCode){case 34:return this.autoQuote(n,'"');case 39:return this.editor.somethingSelected()?this.autoQuote(n,"'"):this.ignoreBracketIfClosed(n,"'");case 8216:return this.autoQuote(n,"‘","‘","’");case 8217:return this.ignoreBracketIfClosed(n,"’");case 8220:return this.autoQuote(n,"“","“","”");case 8221:return this.ignoreBracketIfClosed(n,"”");case 40:return this.autoQuote(n,"(","(",")");case 41:return this.ignoreBracketIfClosed(n,")");case 91:return this.autoQuote(n,"[","[","]");case 93:return this.ignoreBracketIfClosed(n,"]");case 123:return this.autoQuote(n,"{","{","}");case 125:return this.ignoreBracketIfClosed(n,"}");default:if(this.editor.somethingSelected())return;if(this.mode&&this.mode.autoInsertions)return this.mode.autoInsertions(this.editor,n)}},t.prototype.keyup=function(t){var i;if(i=n(t),i!=="Enter")return i==="End"||i==="Home"&&this.widget.visible?this.widget.hide():i==="Left"||i==="Right"?this.widget.hide():i!=="Space"&&i!=="Backspace"&&t.keyCode<48?void 0:this.suggest(this.editor)},t.prototype.handleKeyEvent=function(n,t){return this[t.type]&&this[t.type](t)},t}();window.CodeCompletion=t}).call(this);