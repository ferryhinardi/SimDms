(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";function t(n,t){function r(n){clearTimeout(i.doRedraw);i.doRedraw=setTimeout(function(){i.redraw()},n)}this.cm=n;this.options=t;this.buttonHeight=t.scrollButtonHeight||n.getOption("scrollButtonHeight");this.annotations=[];this.doRedraw=this.doUpdate=null;this.div=n.getWrapperElement().appendChild(document.createElement("div"));this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none";this.computeScale();var i=this;n.on("refresh",this.resizeHandler=function(){clearTimeout(i.doUpdate);i.doUpdate=setTimeout(function(){i.computeScale()&&r(20)},100)});n.on("markerAdded",this.resizeHandler);n.on("markerCleared",this.resizeHandler);if(t.listenForChanges!==!1)n.on("change",this.changeHandler=function(){r(250)})}n.defineExtension("annotateScrollbar",function(n){return typeof n=="string"&&(n={className:n}),new t(this,n)});n.defineOption("scrollButtonHeight",0);t.prototype.computeScale=function(){var n=this.cm,t=(n.getWrapperElement().clientHeight-n.display.barHeight-this.buttonHeight*2)/n.heightAtLine(n.lastLine()+1,"local");if(t!=this.hScale)return this.hScale=t,!0};t.prototype.update=function(n){this.annotations=n;this.redraw()};t.prototype.redraw=function(n){var t,o,l,h;n!==!1&&this.computeScale();var i=this.cm,u=this.hScale,c=document.createDocumentFragment(),r=this.annotations;if(i.display.barWidth)for(t=0;t<r.length;t++){for(var f=r[t],s=o||i.charCoords(f.from,"local").top*u,e=i.charCoords(f.to,"local").bottom*u;t<r.length-1;){if(o=i.charCoords(r[t+1].from,"local").top*u,o>e+.9)break;f=r[++t];e=i.charCoords(f.to,"local").bottom*u}e!=s&&(l=Math.max(e-s,3),h=c.appendChild(document.createElement("div")),h.style.cssText="position: absolute; right: 0px; width: "+Math.max(i.display.barWidth-1,2)+"px; top: "+(s+this.buttonHeight)+"px; height: "+l+"px",h.className=this.options.className)}this.div.textContent="";this.div.appendChild(c)};t.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler);this.cm.off("markerAdded",this.resizeHandler);this.cm.off("markerCleared",this.resizeHandler);this.changeHandler&&this.cm.off("change",this.changeHandler);this.div.parentNode.removeChild(this.div)}});