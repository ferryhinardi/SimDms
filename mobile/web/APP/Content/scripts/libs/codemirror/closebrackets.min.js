(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){function r(n,t){return t=="pairs"&&typeof n=="string"?n:typeof n=="object"&&n[t]!=null?n[t]:o[t]}function h(n){return function(t){return a(t,n)}}function e(n){var t=n.state.closeBrackets,i;return t?(i=n.getModeAt(n.getCursor()),i.closeBrackets||t):null}function c(i){var c=e(i),l,f,h,u,o;if(!c||i.getOption("disableInput"))return n.Pass;for(l=r(c,"pairs"),f=i.listSelections(),u=0;u<f.length;u++)if(!f[u].empty()||(h=s(i,f[u].head),!h||l.indexOf(h)%2!=0))return n.Pass;for(u=f.length-1;u>=0;u--)o=f[u].head,i.replaceRange("",t(o.line,o.ch-1),t(o.line,o.ch+1))}function l(t){var o=e(t),h=o&&r(o,"explode"),i,u,f;if(!h||t.getOption("disableInput"))return n.Pass;for(i=t.listSelections(),u=0;u<i.length;u++)if(!i[u].empty()||(f=s(t,i[u].head),!f||h.indexOf(f)%2!=0))return n.Pass;t.operation(function(){var n,r;for(t.replaceSelection("\n\n",null),t.execCommand("goCharLeft"),i=t.listSelections(),n=0;n<i.length;n++)r=i[n].head.line,t.indentLine(r,null,!0),t.indentLine(r+1,null,!0)})}function a(i,u){var w=e(i),l,o,p,c,d;if(!w||i.getOption("disableInput")||(l=r(w,"pairs"),o=l.indexOf(u),o==-1))return n.Pass;var g=r(w,"triples"),b=l.charAt(o+1)==u,nt=i.listSelections(),k=o%2==0,s,a;for(p=0;p<nt.length;p++){var tt=nt[p],f=tt.head,h,a=i.getRange(f,t(f.line,f.ch+1));if(k&&!tt.empty())h="surround";else if((b||!k)&&a==u)h=g.indexOf(u)>=0&&i.getRange(f,t(f.line,f.ch+3))==u+u+u?"skipThree":"skip";else if(b&&f.ch>1&&g.indexOf(u)>=0&&i.getRange(t(f.line,f.ch-2),f)==u+u&&(f.ch<=2||i.getRange(t(f.line,f.ch-3),t(f.line,f.ch-2))!=u))h="addFour";else if(b)if(!n.isWordChar(a)&&y(i,f,u))h="both";else return n.Pass;else if(k&&(i.getLine(f.line).length==f.ch||v(a,l)||/\s/.test(a)))h="both";else return n.Pass;if(s){if(s!=h)return n.Pass}else s=h}c=o%2?l.charAt(o-1):u;d=o%2?u:l.charAt(o+1);i.operation(function(){var t,n;if(s=="skip")i.execCommand("goCharRight");else if(s=="skipThree")for(n=0;n<3;n++)i.execCommand("goCharRight");else if(s=="surround"){for(t=i.getSelections(),n=0;n<t.length;n++)t[n]=c+t[n]+d;i.replaceSelections(t,"around")}else s=="both"?(i.replaceSelection(c+d,null),i.execCommand("goCharLeft")):s=="addFour"&&(i.replaceSelection(c+c+c+c,"before"),i.execCommand("goCharRight"))})}function v(n,t){var i=t.lastIndexOf(n);return i>-1&&i%2==1}function s(n,i){var r=n.getRange(t(i.line,i.ch-1),t(i.line,i.ch+1));return r.length==2?r:null}function y(t,i,r){var e=t.getLine(i.line),f=t.getTokenAt(i),u,o;if(/\bstring2?\b/.test(f.type))return!1;for(u=new n.StringStream(e.slice(0,i.ch)+r+e.slice(i.ch),4),u.pos=u.start=f.start;;){if(o=t.getMode().token(u,f.state),u.pos>=i.ch+1)return/\bstring2?\b/.test(o);u.start=u.pos}}var o={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},t=n.Pos,u,f,i;for(n.defineOption("autoCloseBrackets",!1,function(t,i,r){r&&r!=n.Init&&(t.removeKeyMap(f),t.state.closeBrackets=null);i&&(t.state.closeBrackets=i,t.addKeyMap(f))}),u=o.pairs+"`",f={Backspace:c,Enter:l},i=0;i<u.length;i++)f["'"+u.charAt(i)+"'"]=h(u.charAt(i))});