(function(n){"use strict";var t=n.editors.TextEditor.prototype.extend();t.prototype.prepare=function(t,i,r,u,f,e){n.editors.TextEditor.prototype.prepare.apply(this,arguments);this.options={};this.cellProperties.select2Options&&(this.options=$.extend(this.options,e.select2Options))};t.prototype.createElements=function(){this.$body=$(document.body);this.TEXTAREA=document.createElement("input");this.TEXTAREA.setAttribute("type","text");this.$textarea=$(this.TEXTAREA);n.Dom.addClass(this.TEXTAREA,"handsontableInput");this.textareaStyle=this.TEXTAREA.style;this.textareaStyle.width=0;this.textareaStyle.height=0;this.TEXTAREA_PARENT=document.createElement("DIV");n.Dom.addClass(this.TEXTAREA_PARENT,"handsontableInputHolder");this.textareaParentStyle=this.TEXTAREA_PARENT.style;this.textareaParentStyle.top=0;this.textareaParentStyle.left=0;this.textareaParentStyle.display="none";this.TEXTAREA_PARENT.appendChild(this.TEXTAREA);this.instance.rootElement[0].appendChild(this.TEXTAREA_PARENT);var t=this;this.instance._registerTimeout(setTimeout(function(){t.refreshDimensions()},0))};var r=function(){this.close();this.finishEditing()},u=function(){this.close();this.finishEditing()},i=function(t){var s=this,r=s.getActiveEditor(),i=n.helper.keyCode,e=(t.ctrlKey||t.metaKey)&&!t.altKey,f,u,o;if($(t.target).hasClass("select2-input")&&!t.isImmediatePropagationStopped()){if(t.keyCode===17||t.keyCode===224||t.keyCode===91||t.keyCode===93){t.stopImmediatePropagation();return}f=t.target;switch(t.keyCode){case i.ARROW_RIGHT:n.Dom.getCaretPosition(f)!==f.value.length?t.stopImmediatePropagation():r.$textarea.select2("close");break;case i.ARROW_LEFT:n.Dom.getCaretPosition(f)!==0?t.stopImmediatePropagation():r.$textarea.select2("close");break;case i.ENTER:u=r.instance.getSelected();o=!(u[0]===u[2]&&u[1]===u[3]);(e&&!o||t.altKey)&&(r.isOpened()?(r.val(r.val()+"\n"),r.focus()):r.beginEditing(r.originalValue+"\n"),t.stopImmediatePropagation());t.preventDefault();break;case i.A:case i.X:case i.C:case i.V:e&&t.stopImmediatePropagation();break;case i.BACKSPACE:case i.DELETE:case i.HOME:case i.END:t.stopImmediatePropagation()}}};t.prototype.open=function(){this.refreshDimensions();this.textareaParentStyle.display="block";this.instance.addHook("beforeKeyDown",i);this.$textarea.css({height:$(this.TD).height()+4,"min-width":$(this.TD).outerWidth()-4});this.$textarea.show();this.$textarea.offset($(this.TD).offset());var n=this;this.$textarea.select2(this.options).on("change",r.bind(this)).on("select2-close",u.bind(this));n.$textarea.select2("open")};t.prototype.init=function(){n.editors.TextEditor.prototype.init.apply(this,arguments)};t.prototype.close=function(){this.instance.listen();this.instance.removeHook("beforeKeyDown",i);this.$textarea.off();this.$textarea.hide();n.editors.TextEditor.prototype.close.apply(this,arguments)};t.prototype.val=function(n){if(typeof n=="undefined")return this.$textarea.val();this.$textarea.val(n)};t.prototype.focus=function(){this.instance.listen()};t.prototype.beginEditing=function(){var t=this.instance.getSettings().onBeginEditing;t&&t()===!1||n.editors.TextEditor.prototype.beginEditing.apply(this,arguments)};t.prototype.finishEditing=function(){return this.instance.listen(),n.editors.TextEditor.prototype.finishEditing.apply(this,arguments)};n.editors.Select2Editor=t;n.editors.registerEditor("select2",t)})(Handsontable);