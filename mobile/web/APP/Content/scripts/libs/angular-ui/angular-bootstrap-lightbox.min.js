angular.module("bootstrapLightbox",["ngTouch","ui.bootstrap","chieffancypants.loadingBar",]);angular.module("bootstrapLightbox").run(["$templateCache",function(n){"use strict";n.put("lightbox.html",'<div class=modal-body ng-swipe-left=Lightbox.nextImage() ng-swipe-right=Lightbox.prevImage()><div class=lightbox-nav><button class=close aria-hidden=true ng-click=$dismiss()>×<\/button><div class=btn-group><a class="btn btn-xs btn-default" ng-click=Lightbox.prevImage()>‹ Previous<\/a> <a ng-href={{Lightbox.imageUrl}} target=_blank class="btn btn-xs btn-default" title="Open in new tab">Open image in new tab<\/a> <a class="btn btn-xs btn-default" ng-click=Lightbox.nextImage()>Next ›<\/a><\/div><\/div><div class=lightbox-image-container><div class=lightbox-image-caption><span>{{Lightbox.imageCaption}}<\/span><\/div><img lightbox-src={{Lightbox.imageUrl}} alt=""><\/div><\/div>')}]);angular.module("bootstrapLightbox").service("ImageLoader",["$q",function(n){this.load=function(t){var i=n.defer(),r=new Image;return r.onload=function(){(typeof this.complete=="boolean"&&this.complete===!1||typeof this.naturalWidth=="number"&&this.naturalWidth===0)&&i.reject();i.resolve(r)},r.onerror=function(){i.reject()},r.src=t,i.promise}}]);angular.module("bootstrapLightbox").provider("Lightbox",function(){this.templateUrl="lightbox.html";this.getImageUrl=function(n){return n.url};this.getImageCaption=function(n){return n.caption};this.calculateImageDimensionLimits=function(n){return n.windowWidth>=768?{maxWidth:n.windowWidth-92,maxHeight:n.windowHeight-126}:{maxWidth:n.windowWidth-52,maxHeight:n.windowHeight-86}};this.calculateModalDimensions=function(n){var t=Math.max(400,n.imageDisplayWidth+32),i=Math.max(200,n.imageDisplayHeight+66);return(t>=n.windowWidth-20||n.windowWidth<768)&&(t="auto"),i>=n.windowHeight&&(i="auto"),{width:t,height:i}};this.$get=["$document","$modal","$timeout","cfpLoadingBar","ImageLoader",function(n,t,i,r,u){var f={};return f.images=[],f.index=-1,f.templateUrl=this.templateUrl,f.getImageUrl=this.getImageUrl,f.getImageCaption=this.getImageCaption,f.calculateImageDimensionLimits=this.calculateImageDimensionLimits,f.calculateModalDimensions=this.calculateModalDimensions,f.keyboardNavEnabled=!1,f.image={},f.modalInstance=null,f.openModal=function(n,i){return f.images=n,f.setImage(i),f.modalInstance=t.open({templateUrl:f.templateUrl,controller:["$scope",function(n){n.Lightbox=f;f.keyboardNavEnabled=!0}],windowClass:"lightbox-modal"}),f.modalInstance.result["finally"](function(){f.images=[];f.index=1;f.image={};f.imageUrl=null;f.imageCaption=null;f.keyboardNavEnabled=!1;r.complete()}),f.modalInstance},f.closeModal=function(n){return f.modalInstance.close(n)},f.setImage=function(n){if(!(n in f.images))throw"Invalid image.";r.start();var t=function(){f.index=n;f.image=f.images[f.index];r.complete()},i=f.getImageUrl(f.images[n]);u.load(i).then(function(){t();f.imageUrl=i;f.imageCaption=f.getImageCaption(f.image)},function(){t();f.imageUrl="//:0";f.imageCaption="Failed to load image"})},f.firstImage=function(){f.setImage(0)},f.prevImage=function(){f.setImage((f.index-1+f.images.length)%f.images.length)},f.nextImage=function(){f.setImage((f.index+1)%f.images.length)},f.lastImage=function(){f.setImage(f.images.length-1)},f.setImages=function(n){f.images=n;f.setImage(f.index)},n.bind("keydown",function(n){if(f.keyboardNavEnabled){var t=null;switch(n.which){case 39:t="nextImage";break;case 37:t="prevImage"}t!==null&&["input","textarea"].indexOf(n.target.tagName.toLowerCase())===-1&&(i(function(){f[t]()}),n.preventDefault())}}),f}]});angular.module("bootstrapLightbox").directive("lightboxSrc",["$window","ImageLoader","Lightbox",function(n,t,i){var f=function(n){var t=n.width,i=n.height,o=n.minWidth,s=n.minHeight,f=n.maxWidth,e=n.maxHeight,r=t,u=i;return t<o&&i<s?t/i>f/e?(u=s,r=Math.round(t*s/i)):(r=o,u=Math.round(i*o/t)):t<o?(r=o,u=Math.round(i*o/t)):i<s&&(u=s,r=Math.round(t*s/i)),t>f&&i>e?t/i>f/e?(r=f,u=Math.round(i*f/t)):(u=e,r=Math.round(t*e/i)):t>f?(r=f,u=Math.round(i*f/t)):i>e&&(u=e,r=Math.round(t*e/i)),{width:r||0,height:u||0}},r=0,u=0;return{link:function(e,o,s){var h=function(){var e=n.innerWidth,s=n.innerHeight,c=i.calculateImageDimensionLimits({windowWidth:e,windowHeight:s,imageWidth:r,imageHeight:u}),t=f(angular.extend({width:r,height:u,minWidth:1,minHeight:1,maxWidth:3e3,maxHeight:3e3},c)),h=i.calculateModalDimensions({windowWidth:e,windowHeight:s,imageDisplayWidth:t.width,imageDisplayHeight:t.height});o.css({width:t.width+"px",height:t.height+"px"});angular.element(document.querySelector(".lightbox-modal .modal-dialog")).css({width:h.width+"px"});angular.element(document.querySelector(".lightbox-modal .modal-content")).css({height:h.height+"px"})};e.$watch(function(){return s.lightboxSrc},function(n){o[0].src="//:0";t.load(n).then(function(t){r=t.naturalWidth;u=t.naturalHeight;h();o[0].src=n})});angular.element(n).on("resize",h)}}}]);