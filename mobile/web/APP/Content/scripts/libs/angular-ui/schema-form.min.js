var deps=[];try{angular.module("ngSanitize");deps.push("ngSanitize")}catch(e){}try{angular.module("ui.sortable");deps.push("ui.sortable")}catch(e){}try{angular.module("angularSpectrumColorpicker");deps.push("angularSpectrumColorpicker")}catch(e){}angular.module("schemaForm",deps);angular.module("schemaForm").provider("sfPath",[function(){var n={parse:ObjectPath.parse};n.stringify=angular.version.major===1&&angular.version.minor<3?function(n){return Array.isArray(n)?n.join("."):n.toString()}:ObjectPath.stringify;n.normalize=function(t,i){return n.stringify(Array.isArray(t)?t:n.parse(t),i)};this.parse=n.parse;this.stringify=n.stringify;this.normalize=n.normalize;this.$get=function(){return n}}]);angular.module("schemaForm").factory("sfSelect",["sfPath",function(n){var t=/^\d+$/;return function(i,r,u){var f,o,e,s;if(r||(r=this),f=typeof i=="string"?n.parse(i):i,typeof u!="undefined"&&f.length===1)return r[f[0]]=u,r;for(typeof u!="undefined"&&typeof r[f[0]]=="undefined"&&(r[f[0]]=f.length>2&&t.test(f[1])?[]:{}),o=r[f[0]],e=1;e<f.length;e++){if(f[e]==="")return undefined;if(typeof u!="undefined"){if(e===f.length-1)return o[f[e]]=u,u;s=o[f[e]];(typeof s=="undefined"||s===null)&&(s=t.test(f[e+1])?[]:{},o[f[e]]=s);o=s}else o&&(o=o[f[e]])}return o}}]);angular.module("schemaForm").provider("schemaFormDecorators",["$compileProvider","sfPathProvider",function(n,t){var r="",i={},e=function(n,t){var u,e,f,o;for(n==="sfDecorator"&&(n=r),u=i[n],e=u.rules,f=0;f<e.length;f++)if(o=e[f](t),o)return o;return u.mappings[t.type]?u.mappings[t.type]:u.mappings["default"]},u=function(i){n.directive(i,["$parse","$compile","$http","$templateCache","$interpolate","sfErrorMessage",function(n,r,u,f,o,s){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"?^sfSchema",link:function(n,h,c,l){n.$on("schemaFormPropagateNgModelController",function(t,i){t.stopPropagation();t.preventDefault();n.ngModel=i});n.showTitle=function(){return n.form&&n.form.notitle!==!0&&n.form.title};n.listToCheckboxValues=function(n){var t={};return angular.forEach(n,function(n){t[n]=!0}),t};n.checkboxValuesToList=function(n){var t=[];return angular.forEach(n,function(n,i){n&&t.push(i)}),t};n.buttonClick=function(t,i){if(angular.isFunction(i.onClick))i.onClick(t,i);else angular.isString(i.onClick)&&(l?l.evalInParentScope(i.onClick,{$event:t,form:i}):n.$eval(i.onClick,{$event:t,form:i}))};n.evalExpr=function(t,i){return l?l.evalInParentScope(t,i):n.$eval(t,i)};n.evalInScope=function(t,i){if(t)return n.$eval(t,i)};n.interp=function(n,t){return n&&o(n)(t)};n.hasSuccess=function(){return n.ngModel?n.ngModel.$valid&&(!n.ngModel.$pristine||!n.ngModel.$isEmpty(n.ngModel.$modelValue)):!1};n.hasError=function(){return n.ngModel?n.ngModel.$invalid&&!n.ngModel.$pristine:!1};n.errorMessage=function(t){return s.interpolate(t&&t.code+""||"default",n.ngModel&&n.ngModel.$modelValue||"",n.form,n.options&&n.options.validationMessage)};var a=n.$watch(c.form,function(o){if(o){o.ngModelOptions=o.ngModelOptions||{};n.form=o;var s=e(i,o);u.get(s,{cache:f}).then(function(i){var u=o.key?t.stringify(o.key).replace(/"/g,"&quot;"):"",f=i.data.replace(/\$\$value\$\$/g,"model"+(u[0]!=="["?".":"")+u);h.html(f);o.condition&&angular.forEach(h.children(),function(n){var t=n.getAttribute("ng-if");n.setAttribute("ng-if",t?"("+t+') || (evalExpr(form.condition,{ model: model, "arrayIndex": arrayIndex }))':'evalExpr(form.condition,{ model: model, "arrayIndex": arrayIndex })')});r(h.contents())(n)});o.key&&n.$on("schemaForm.error."+o.key.join("."),function(t,i,r,u){(r===!0||r===!1)&&(u=r,r=undefined);n.ngModel&&i&&(n.ngModel.$setDirty()?n.ngModel.$setDirty():(n.ngModel.$dirty=!0,n.ngModel.$pristine=!1),r&&(o.validationMessage||(o.validationMessage={}),console.log("settings validationMessage",r),o.validationMessage[i]=r),n.ngModel.$setValidity(i,u===!0),n.$broadcast("schemaFormValidate"))});a()}})}}}])},f=function(t,i,r){r=angular.isDefined(r)?r:!1;n.directive("sf"+angular.uppercase(t[0])+t.substr(1),function(){return{restrict:"EAC",scope:!0,replace:!0,transclude:r,template:'<sf-decorator form="form"><\/sf-decorator>',link:function(n,i,r){var e={items:"c",titleMap:"c",schema:"c"},u={type:t},f=!0;angular.forEach(r,function(t,i){if(i[0]!=="$"&&i.indexOf("ng")!==0&&i!=="sfField"){var o=function(t){angular.isDefined(t)&&t!==u[i]&&(u[i]=t,f&&u.type&&(u.key||angular.isUndefined(r.key))&&(n.form=u,f=!1))};i==="model"?n.$watch(t,function(t){t&&n.model!==t&&(n.model=t)}):e[i]==="c"?n.$watchCollection(t,o):r.$observe(i,o)}})}}})};this.createDecorator=function(n,t,f){i[n]={mappings:t||{},rules:f||[]};i[r]||(r=n);u(n)};this.createDirective=f;this.createDirectives=function(n){angular.forEach(n,function(n,t){f(t,n)})};this.directive=function(n){return n=n||r,i[n]};this.addMapping=function(n,t,r){i[n]&&(i[n].mappings[t]=r)};this.$get=function(){return{directive:function(n){return i[n]},defaultDecorator:r}};u("sfDecorator")}]);angular.module("schemaForm").provider("sfErrorMessage",function(){var n={"default":"Field does not validate",0:"Invalid type, expected {{schema.type}})",1:"No enum match for: {{value}}",10:'Data does not match any schemas from "anyOf"',11:'Data does not match any schemas from "oneOf"',12:'Data is valid against more than one schema from "oneOf"',13:'Data matches schema from "not"',100:"Value {{value}} is not a multiple of {{schema.multipleOf}}",101:"Value {{value}} is less than minimum {{schema.minimum}}",102:"Value {{value}} is equal to exclusive minimum {{schema.minimum}}",103:"Value {{value}} is greater than maximum {{schema.maximum}}",104:"Value {{value}} is equal to exclusive maximum {{schema.maximum}}",105:"Value {{value}} is not a valid number",200:"String is too short ({{value.length}} chars), minimum {{schema.minimum}}",201:"String is too long ({{value.length}} chars), maximum {{schema.maximum}}",202:"String does not match pattern: {{schema.pattern}}",300:"Too few properties defined, minimum {{schema.minimum}}",301:"Too many properties defined, maximum {{schema.maximum}}",302:"Required",303:"Additional properties not allowed",304:"Dependency failed - key must exist",400:"Array is too short ({{value.length}}), minimum {{schema.minimum}}",401:"Array is too long ({{value.length}}), maximum {{schema.maximum}}",402:"Array items are not unique",403:"Additional items not allowed",500:"Format validation failed",501:'Keyword failed: "{{title}}"',600:"Circular $refs",1e3:"Unknown property (not in schema)"};this.setDefaultMessages=function(t){n=t};this.getDefaultMessages=function(){return n};this.setDefaultMessage=function(t,i){n[t]=i};this.$get=["$interpolate",function(t){var i={};return i.defaultMessages=n,i.interpolate=function(i,r,u,f){var o,e,s;return f=f||{},o=u.validationMessage||{},i.indexOf("tv4-")===0&&(i=i.substring(4)),e=o["default"]||f["default"]||"",[o,f,n].some(function(n){return angular.isString(n)||angular.isFunction(n)?(e=n,!0):n&&n[i]?(e=n[i],!0):void 0}),s={error:i,value:r,form:u,schema:u.schema,title:u.title||u.schema&&u.schema.title},angular.isFunction(e)?e(s):t(e)(s)},i}]});angular.module("schemaForm").provider("schemaForm",["sfPathProvider",function(n){var t=function(n){if(Array.isArray(n)&&n.length==2){if(n[0]==="null")return n[1];if(n[1]==="null")return n[0]}return n},f=function(n){var t=[];return n.forEach(function(n){t.push({name:n,value:n})}),t},e=function(n,t){if(!angular.isArray(n)){var i=[];return t?angular.forEach(t,function(t){i.push({name:n[t],value:t})}):angular.forEach(n,function(n,t){i.push({name:n,value:t})}),i}return n},u=function(n,i,u){var o=r[t(i.type)],f,e;if(o)for(e=0;e<o.length;e++)if(f=o[e](n,i,u),f)return f.schema["x-schema-form"]&&angular.isObject(f.schema["x-schema-form"])&&(f=angular.extend(f,f.schema["x-schema-form"])),f},i=function(n,t,i){i=i||{};var r=i.global&&i.global.formDefaults?angular.copy(i.global.formDefaults):{};return r.title=i.global&&i.global.supressPropertyTitles===!0?t.title:t.title||n,t.description&&(r.description=t.description),(i.required===!0||t.required===!0)&&(r.required=!0),t.maxLength&&(r.maxlength=t.maxLength),t.minLength&&(r.minlength=t.maxLength),(t.readOnly||t.readonly)&&(r.readonly=!0),t.minimum&&(r.minimum=t.minimum+(t.exclusiveMinimum?1:0)),t.maximum&&(r.maximum=t.maximum-(t.exclusiveMaximum?1:0)),t.validationMessage&&(r.validationMessage=t.validationMessage),t.enumNames&&(r.titleMap=e(t.enumNames,t["enum"])),r.schema=t,r.ngModelOptions=r.ngModelOptions||{},r},s=function(r,u,f){if(t(u.type)==="string"&&!u["enum"]){var e=i(r,u,f);return e.key=f.path,e.type="text",f.lookup[n.stringify(f.path)]=e,e}},h=function(r,u,f){if(t(u.type)==="number"){var e=i(r,u,f);return e.key=f.path,e.type="number",f.lookup[n.stringify(f.path)]=e,e}},c=function(r,u,f){if(t(u.type)==="integer"){var e=i(r,u,f);return e.key=f.path,e.type="number",f.lookup[n.stringify(f.path)]=e,e}},l=function(r,u,f){if(t(u.type)==="boolean"){var e=i(r,u,f);return e.key=f.path,e.type="checkbox",f.lookup[n.stringify(f.path)]=e,e}},a=function(r,u,e){if(t(u.type)==="string"&&u["enum"]){var o=i(r,u,e);return o.key=e.path,o.type="select",o.titleMap||(o.titleMap=f(u["enum"])),e.lookup[n.stringify(e.path)]=o,o}},v=function(r,u,e){if(t(u.type)==="array"&&u.items&&u.items["enum"]){var o=i(r,u,e);return o.key=e.path,o.type="checkboxes",o.titleMap||(o.titleMap=f(u.items["enum"])),e.lookup[n.stringify(e.path)]=o,o}},y=function(r,f,e){if(t(f.type)==="object"){var o=i(r,f,e);return o.type="fieldset",o.items=[],e.lookup[n.stringify(e.path)]=o,angular.forEach(f.properties,function(t,i){var r=e.path.slice(),h,s;r.push(i);e.ignore[n.stringify(r)]!==!0&&(h=f.required&&f.required.indexOf(i)!==-1,s=u(i,t,{path:r,required:h||!1,lookup:e.lookup,ignore:e.ignore}),s&&o.items.push(s))}),o}},p=function(r,f,e){var o,h,s;if(t(f.type)==="array")return o=i(r,f,e),o.type="array",o.key=e.path,e.lookup[n.stringify(e.path)]=o,h=f.required&&f.required.indexOf(e.path[e.path.length-1])!==-1,s=e.path.slice(),s.push(""),o.items=[u(r,f.items,{path:s,required:h||!1,lookup:e.lookup,ignore:e.ignore,global:e.global})],o},r={string:[a,s],object:[y],number:[h],integer:[c],boolean:[l],array:[v,p]},o=function(n){return n};this.defaults=r;this.stdFormObj=i;this.defaultFormDefinition=u;this.postProcess=function(n){o=n};this.appendRule=function(n,t){r[n]||(r[n]=[]);r[n].push(t)};this.prependRule=function(n,t){r[n]||(r[n]=[]);r[n].unshift(t)};this.createStandardForm=i;this.$get=function(){var i={};return i.merge=function(t,r,u,f,s){var l,h,c;return r=r||["*"],f=f||{},s=s||t.readonly||t.readOnly,l=i.defaults(t,u,f),h=r.indexOf("*"),h!==-1&&(r=r.slice(0,h).concat(l.form).concat(r.slice(h+1))),c=l.lookup,o(r.map(function(r){var h,l,o;return typeof r=="string"&&(r={key:r}),r.key&&typeof r.key=="string"&&(r.key=n.parse(r.key)),r.titleMap&&(r.titleMap=e(r.titleMap)),r.itemForm&&(r.items=[],h=n.stringify(r.key),l=c[h],angular.forEach(l.items,function(n){var t=angular.copy(r.itemForm);t.key=n.key;r.items.push(t)})),r.key&&(o=n.stringify(r.key),c[o]&&(r=angular.extend(c[o],r))),s===!0&&(r.readonly=!0),r.items&&(r.items=i.merge(t,r.items,u,f,r.readonly)),r.tabs&&angular.forEach(r.tabs,function(n){n.items=i.merge(t,n.items,u,f,r.readonly)}),r.type==="checkbox"&&angular.isUndefined(r.schema["default"])&&(r.schema["default"]=!1),r}))},i.defaults=function(n,i,r){var f=[],e={};if(i=i||{},r=r||{},t(n.type)==="object")angular.forEach(n.properties,function(t,o){if(i[o]!==!0){var h=n.required&&n.required.indexOf(o)!==-1,s=u(o,t,{path:[o],lookup:e,ignore:i,required:h,global:r});s&&f.push(s)}});else throw new Error('Not implemented. Only type "object" allowed at root level of schema.');return{form:f,lookup:e}},i.traverseSchema=function(n,t,i,r){r=angular.isDefined(r)?r:!0;i=i||[];var u=function(n,t,i){if(t(n,i),angular.forEach(n.properties,function(n,r){var f=i.slice();f.push(r);u(n,t,f)}),!r&&n.items){var f=i.slice();f.push("");u(n.items,t,f)}};u(n,t,i||[])},i.traverseForm=function(n,t){t(n);angular.forEach(n.items,function(n){i.traverseForm(n,t)});n.tabs&&angular.forEach(n.tabs,function(n){angular.forEach(n.items,function(n){i.traverseForm(n,t)})})},i}}]);angular.module("schemaForm").factory("sfValidator",[function(){var n={};return n.validate=function(n,t){var u,i,r,f;return n?(u=n.schema,!u)?{valid:!0}:(t===""&&(t=undefined),n.type==="number"&&t===null&&(t=undefined),i={type:"object",properties:{}},r=n.key[n.key.length-1],i.properties[r]=u,n.required&&(i.required=[r]),f={},angular.isDefined(t)&&(f[r]=t),tv4.validateResult(f,i)):{valid:!0}},n}]);angular.module("schemaForm").directive("sfArray",["sfSelect","schemaForm","sfValidator","sfPath",function(n,t,i,r){var u=function(n){return function(t){t.key&&(t.key[t.key.indexOf("")]=n)}};return{restrict:"A",scope:!0,require:"?ngModel",link:function(f,e,o,s){var h={},c;s&&f.$emit("schemaFormPropagateNgModelController",s);c=f.$watch(o.sfArray,function(e){var o=n(e.key,f.model),l,a,v;f.$watch("model"+r.normalize(e.key),function(){o=n(e.key,f.model);f.modelArray=o});angular.isUndefined(o)&&(o=[],n(e.key,f.model,o));f.modelArray=o;e.items&&(l=e.items[0],e.items.length>1&&(l={type:"section",items:e.items.map(function(n){return n.ngModelOptions=e.ngModelOptions,angular.isUndefined(n.readonly)&&(n.readonly=e.readonly),n})}));f.copyWithIndex=function(n){if(!h[n]&&l){var i=angular.copy(l);i.arrayIndex=n;t.traverseForm(i,u(n));h[n]=i}return h[n]};f.appendToArray=function(){var u=o.length,s=f.copyWithIndex(u),i,r;return t.traverseForm(s,function(t){if(t.key){var i;angular.isDefined(t["default"])&&(i=t["default"]);angular.isDefined(t.schema)&&angular.isDefined(t.schema["default"])&&(i=t.schema["default"]);angular.isDefined(i)&&n(t.key,f.model,i)}}),u===o.length&&(i=n("schema.items.type",e),i==="object"?r={}:i==="array"&&(r=[]),o.push(r)),f.validateArray&&f.validateArray(),o};f.deleteFromArray=function(n){return o.splice(n,1),f.validateArray&&f.validateArray(),s&&s.$setDirty&&s.$setDirty(),o};e.titleMap||e.startEmpty===!0||o.length!==0||f.appendToArray();e.titleMap&&e.titleMap.length>0&&(f.titleMapValues=[],a=function(n){f.titleMapValues=[];n=n||[];e.titleMap.forEach(function(t){f.titleMapValues.push(n.indexOf(t.value)!==-1)})},a(f.modelArray),f.$watchCollection("modelArray",a),f.$watchCollection("titleMapValues",function(n){if(n){for(var t=f.modelArray;t.length>0;)t.pop();e.titleMap.forEach(function(i,r){n[r]&&t.push(i.value)})}}));s&&(f.validateArray=function(){var n=i.validate(e,f.modelArray.length>0?f.modelArray:undefined);Object.keys(s.$error).filter(function(n){return n.indexOf("tv4-")===0}).forEach(function(n){s.$setValidity(n,!0)});n.valid===!1&&n.error&&(n.error.dataPath===""||n.error.dataPath==="/"+e.key[e.key.length-1])&&(s.$setViewValue(f.modelArray),v=n.error,s.$setValidity("tv4-"+n.error.code,!1))},f.$on("schemaFormValidate",f.validateArray),f.hasSuccess=function(){return s.$valid&&!s.$pristine},f.hasError=function(){return s.$invalid},f.schemaError=function(){return v});c()})}}}]);angular.module("schemaForm").directive("sfChanged",function(){return{require:"ngModel",restrict:"AC",scope:!1,link:function(n,t,i,r){var u=n.$eval(i.sfChanged);u&&u.onChange&&r.$viewChangeListeners.push(function(){if(angular.isFunction(u.onChange))u.onChange(r.$modelValue,u);else n.evalExpr(u.onChange,{modelValue:r.$modelValue,form:u})})}}});angular.module("schemaForm").directive("sfMessage",["$injector","sfErrorMessage",function(n,t){return{scope:!1,restrict:"EA",link:function(i,r,u){var o=n.has("$sanitize")?n.get("$sanitize"):function(n){return n},f="",e;u.sfMessage&&(f=i.$eval(u.sfMessage)||"",f=o(f));e=function(n){if(n&&i.hasError())r.html(f);else{var u=Object.keys(i.ngModel&&i.ngModel.$error||{}),e=u[0];u.length>1&&(e=u.reduce(function(n,t){return n&&n.indexOf("tv4-")===0?n:t}),console.log("reduced",u,e));e?r.html(t.interpolate(e,i.ngModel.$modelValue,i.form,i.options&&i.options.validationMessage)):r.html(f)}};e();i.$watchCollection("ngModel.$error",function(){i.ngModel&&e(i.ngModel.$valid)})}}}]);angular.module("schemaForm").directive("sfSchema",["$compile","schemaForm","schemaFormDecorators","sfSelect","sfPath",function(n,t,i,r,u){var f=/[A-Z]/g,e=function(n,t){return t=t||"_",n.replace(f,function(n,i){return(i?t:"")+n.toLowerCase()})};return{scope:{schema:"=sfSchema",initialForm:"=sfForm",model:"=sfModel",options:"=sfOptions"},controller:["$scope",function(n){this.evalInParentScope=function(t,i){return n.$parent.$eval(t,i)}}],replace:!1,restrict:"A",transclude:!0,require:"?form",link:function(f,o,s,h,c){var v,l,a,y;f.formCtrl=h;v={};c(f,function(n){var t,i,r;if(n.addClass("schema-form-ignore"),o.prepend(n),o[0].querySelectorAll&&(t=o[0].querySelectorAll("[ng-model]"),t))for(i=0;i<t.length;i++)r=t[i].getAttribute("ng-model"),v[r.substring(r.indexOf(".")+1)]=!0});l={};y=function(h,c){var w=t.merge(h,c,v,f.options),b=document.createDocumentFragment(),p,y,l;for(a&&a.$destroy(),a=f.$new(),a.schemaForm={form:w,schema:h},o.children(":not(.schema-form-ignore)").remove(),p={},y=o[0].querySelectorAll("*[sf-insert-field]"),l=0;l<y.length;l++)p[y[l].getAttribute("sf-insert-field")]=y[l];angular.forEach(w,function(n,t){var f=document.createElement(s.sfUseDecorator||e(i.defaultDecorator,"-")),r;if(f.setAttribute("form","schemaForm.form["+t+"]"),n.key&&(r=p[u.stringify(n.key)],r)){while(r.firstChild)r.removeChild(r.firstChild);r.appendChild(f);return}b.appendChild(f)});o[0].appendChild(b);n(o.children())(a);t.traverseSchema(h,function(n,t){if(angular.isDefined(n["default"])){var i=r(t,f.model);angular.isUndefined(i)&&r(t,f.model,n["default"])}});f.$emit("sf-render-finished",o)};f.$watch(function(){var n=f.schema,t=f.initialForm||["*"];t&&n&&n.type&&(l.form!==t||l.schema!==n)&&Object.keys(n.properties).length>0&&(l.schema=n,l.form=t,y(n,t))});f.$on("schemaFormRedraw",function(){var n=f.schema,t=f.initialForm||["*"];n&&y(n,t)})}}}]);angular.module("schemaForm").directive("schemaValidate",["sfValidator","sfSelect",function(n,t){return{restrict:"A",scope:!1,priority:500,require:"ngModel",link:function(i,r,u,f){var o;i.$emit("schemaFormPropagateNgModelController",f);var s=null,h=function(){return e||(e=i.$eval(u.schemaValidate)),e},e=h();e.copyValueTo&&f.$viewChangeListeners.push(function(){var n=e.copyValueTo;angular.forEach(n,function(n){t(n,i.model,f.$modelValue)})});o=function(t){if(e=h(),!e)return t;var i=n.validate(e,t);return(Object.keys(f.$error).filter(function(n){return n.indexOf("tv4-")===0}).forEach(function(n){f.$setValidity(n,!0)}),!i.valid)?(f.$setValidity("tv4-"+i.error.code,!1),s=i.error,undefined):t};f.$parsers.push(o);i.$on("schemaFormValidate",function(){f.$setDirty?f.$setDirty():f.$setViewValue(f.$viewValue);o(f.$viewValue)});i.schemaError=function(){return s}}}}]);