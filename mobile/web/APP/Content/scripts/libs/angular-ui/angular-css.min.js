/**
 * AngularCSS - CSS on-demand for AngularJS
 * @version v1.0.7
 * @author DOOR3, Alex Castillo
 * @link http://door3.github.io/angular-css
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
(function(n){var i=n.module("door3.css",[]),t,r;i.config(["$logProvider",function(n){n.debugEnabled(!1)}]);i.provider("$css",[function(){var i=this.defaults={element:"link",rel:"stylesheet",type:"text/css",container:"head",method:"append",weight:0};this.$get=["$rootScope","$injector","$q","$window","$timeout","$compile","$http","$filter","$log",function(r,u,f,e,o,s,h,c,l){function g(n,t,i){i&&t.hasOwnProperty("css")&&a.bind([v(t.css)],i)}function nt(n,t,i){i&&(a.remove(a.getFromRoute(i).concat(y)),y.length=0);t&&a.add(a.getFromRoute(t))}function tt(n,t,i,r){r&&(a.remove(a.getFromState(r).concat(y)),y.length=0);t&&a.add(a.getFromState(t))}function it(t){n.isDefined(p.breakpoints)&&(t.breakpoint in p.breakpoints&&(t.media=p.breakpoints[t.breakpoint]),delete t.breakpoints)}function v(t){if(t)return n.isFunction(t)&&(t=n.copy(u.invoke(t))),n.isString(t)&&(t=n.extend({href:t},p)),n.isArray(t)&&n.isString(t[0])&&n.forEach(t,function(i){t=n.extend({href:i},p)}),n.isObject(t)&&!n.isArray(t)&&(t=n.extend(t,p)),n.isArray(t)&&n.isObject(t[0])&&n.forEach(t,function(i){t=n.extend(i,p)}),it(t),t}function rt(n){if(!n)return l.error("No stylesheets provided");var t="?cache=";n.href.indexOf(t)===-1&&(n.href=n.href+(n.bustCache?t+(new Date).getTime():""))}function ut(n,t){return!n||!t?l.error("filterBy: missing array or property"):c("filter")(n,function(n){return n[t]})}function ft(n){if(!n)return l.error("No stylesheet provided");w[n.href]=e.matchMedia(n.media);b[n.href]=function(t){o(function(){if(t.matches)r.stylesheets.push(n);else{var i=r.stylesheets.indexOf(c("filter")(r.stylesheets,{href:n.href})[0]);i!==-1&&r.stylesheets.splice(i,1)}})};w[n.href].addListener(b[n.href]);b[n.href](w[n.href])}function et(t){if(!t)return l.error("No stylesheet provided");r&&n.isDefined(w)&&w[t.href]&&n.isDefined(b)&&w[t.href].removeListener(b[t.href])}function ot(n){return n?!!(n.media&&k.indexOf(n.media)===-1&&e.matchMedia):l.error("No stylesheet provided")}var a={},w={},b={},k=["print"],p=n.extend({},i),d=n.element(document.querySelector?document.querySelector(p.container):document.getElementsByTagName(p.container)[0]),y=[];return n.forEach(t,function(n,i){n.hasOwnProperty("css")&&(t[i]=v(n.css))}),r.stylesheets=[],d[p.method](s('<link ng-repeat="stylesheet in stylesheets track by $index | orderBy: \'weight\' " rel="{{ stylesheet.rel }}" type="{{ stylesheet.type }}" ng-href="{{ stylesheet.href }}" ng-attr-media="{{ stylesheet.media }}">')(r)),r.$on("$directiveAdd",g),r.$on("$routeChangeSuccess",nt),r.$on("$stateChangeSuccess",tt),a.getFromRoute=function(t){if(!t)return l.error("Get From Route: No route provided");var i=null,r=[];return t.$$route&&t.$$route.css?i=t.$$route.css:t.css&&(i=t.css),i&&(n.isArray(i)?n.forEach(i,function(t){n.isFunction(t)&&y.push(v(t));r.push(v(t))}):(n.isFunction(i)&&y.push(v(i)),r.push(v(i)))),r},a.getFromRoutes=function(t){if(!t)return l.error("Get From Routes: No routes provided");var i=[];return n.forEach(t,function(n){var t=a.getFromRoute(n);t.length&&i.push(t[0])}),i},a.getFromState=function(t){if(!t)return l.error("Get From State: No state provided");var i=[];return n.isDefined(t.views)&&n.forEach(t.views,function(t){t.css&&(n.isFunction(t.css)&&y.push(v(t.css)),i.push(v(t.css)))}),n.isDefined(t.children)&&n.forEach(t.children,function(t){t.css&&(n.isFunction(t.css)&&y.push(v(t.css)),i.push(v(t.css)));n.isDefined(t.children)&&n.forEach(t.children,function(t){t.css&&(n.isFunction(t.css)&&y.push(v(t.css)),i.push(v(t.css)))})}),n.isDefined(t.css)&&(n.isArray(t.css)?n.forEach(t.css,function(t){n.isFunction(t)&&y.push(v(t));i.push(v(t))}):(n.isFunction(t.css)&&y.push(v(t.css)),i.push(v(t.css)))),i},a.getFromStates=function(t){if(!t)return l.error("Get From States: No states provided");var i=[];return n.forEach(t,function(t){var r=a.getFromState(t);n.isArray(r)?n.forEach(r,function(n){i.push(n)}):i.push(r)}),i},a.preload=function(i,r){i||(i=[],t.length&&Array.prototype.push.apply(i,t),u.has("$route")&&Array.prototype.push.apply(i,a.getFromRoutes(u.get("$route").routes)),u.has("$state")&&Array.prototype.push.apply(i,a.getFromStates(u.get("$state").get())),i=ut(i,"preload"));n.isArray(i)||(i=[i]);var e=[];n.forEach(i,function(n,t){n=i[t]=v(n);e.push(h.get(n.href).error(function(){l.error("AngularCSS: Incorrect path for "+n.href)}))});n.isFunction(r)&&f.all(e).then(function(){r(i)})},a.bind=function(t,i){if(!t||!i)return l.error("No scope or stylesheets provided");var r=[];n.isArray(t)?n.forEach(t,function(n){r.push(v(n))}):r.push(v(t));a.add(r);l.debug("$css.bind(): Added",r);i.$on("$destroy",function(){a.remove(r);l.debug("$css.bind(): Removed",r)})},a.add=function(t){if(!t)return l.error("No stylesheets provided");n.isArray(t)||(t=[t]);n.forEach(t,function(n){n=v(n);n.href&&!c("filter")(r.stylesheets,{href:n.href}).length&&(rt(n),ot(n)?ft(n):r.stylesheets.push(n),l.debug("$css.add(): "+n.href))});r.$broadcast("$cssAdd",t,r.stylesheets)},a.remove=function(t){if(!t)return l.error("No stylesheets provided");n.isArray(t)||(t=[t]);t=c("filter")(t,function(n){return!n.persist});n.forEach(t,function(n){n=v(n);var t=r.stylesheets.indexOf(c("filter")(r.stylesheets,{href:n.href})[0]);t!==-1&&r.stylesheets.splice(t,1);et(n);l.debug("$css.remove(): "+n.href)});r.$broadcast("$cssRemove",t,r.stylesheets)},a.removeAll=function(){r&&r.hasOwnProperty("stylesheets")&&(r.stylesheets.length=0);l.debug("all stylesheets removed")},a.preload(),a}]}]);i.filter("$cssLinks",function(){return function(t){if(!t||!n.isArray(t))return t;var i="";return n.forEach(t,function(n){i+='<link rel="'+n.rel+'" type="'+n.type+'" href="'+n.href+'"';i+=n.media?' media="'+n.media+'"':"";i+=">\n\n"}),i}});i.run(["$css",function(){}]);t=[];r=n.module;n.module=function(){var i=r.apply(this,arguments),u=i.directive;return i.directive=function(i,r){var e=n.isFunction(r)?r:r[r.length-1],f;try{f=n.copy(e)();f.directiveName=i;f.hasOwnProperty("css")&&t.push(f)}catch(o){}return u.apply(this,arguments)},i.config(["$provide","$injector",function(i,r){n.forEach(t,function(n){var t=n.directiveName+"Directive";r.has(t)&&i.decorator(t,["$delegate","$rootScope","$timeout",function(t,i,r){var u=t[0],f=u.compile;return u.css&&(n.css=u.css),u.compile=function(){var n=f?f.apply(this,arguments):!1;return function(t){var f=arguments;r(function(){n&&n.apply(this,f)});i.$broadcast("$directiveAdd",u,t)}},t}])})}]),i}})(angular);