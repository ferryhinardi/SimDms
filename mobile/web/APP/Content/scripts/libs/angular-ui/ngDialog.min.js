(function(n,t){typeof module!="undefined"&&module.exports?module.exports=t(require("angular")):typeof define=="function"&&define.amd?define(["angular"],t):t(n.angular)})(this,function(n){"use strict";var f=n.module("ngDialog",[]),i=n.element,r=n.isDefined,u=(document.body||document.documentElement).style,s=r(u.animation)||r(u.WebkitAnimation)||r(u.MozAnimation)||r(u.MsAnimation)||r(u.OAnimation),e="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",h="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",o=!1,t;return f.provider("ngDialog",function(){var l=this.defaults={className:"ngdialog-theme-default",plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,overlay:!0,cache:!0,trapFocus:!0,preserveFocus:!0,ariaAuto:!0,ariaRole:null,ariaLabelledById:null,ariaLabelledBySelector:null,ariaDescribedById:null,ariaDescribedBySelector:null};this.setForceBodyReload=function(n){o=n||!1};this.setDefaults=function(t){n.extend(l,t)};var u=0,r=0,f,c={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller",function(a,v,y,p,w,b,k,d,g){var tt=a.find("body"),nt,it;return o&&b.$on("$locationChangeSuccess",function(){tt=a.find("body")}),nt={onDocumentKeydown:function(n){n.keyCode===27&&it.close("$escape")},activate:function(n){var t=n.data("$ngDialogOptions");if(t.trapFocus){n.on("keydown",nt.onTrapFocusKeydown);tt.on("keydown",nt.onTrapFocusKeydown)}},deactivate:function(n){n.off("keydown",nt.onTrapFocusKeydown);tt.off("keydown",nt.onTrapFocusKeydown)},deactivateAll:function(){n.forEach(function(t){var i=n.element(t);nt.deactivate(i)})},setBodyPadding:function(n){var t=parseInt(tt.css("padding-right")||0,10);tt.css("padding-right",t+n+"px");tt.data("ng-dialog-original-padding",t)},resetBodyPadding:function(){var n=tt.data("ng-dialog-original-padding");n?tt.css("padding-right",n+"px"):tt.css("padding-right","")},performCloseDialog:function(n,i){var u=n.attr("id"),o,h;typeof d.Hammer!="undefined"?(o=t.hammerTime,o.off("tap",f),o.destroy&&o.destroy(),delete t.hammerTime):n.unbind("click");r===1&&tt.unbind("keydown");n.hasClass("ngdialog-closing")||(r-=1);h=n.data("$ngDialogPreviousFocus");h&&h.focus();b.$broadcast("ngDialog.closing",n);r=r<0?0:r;s?(t.$destroy(),n.unbind(e).bind(e,function(){n.remove();r===0&&(tt.removeClass("ngdialog-open"),nt.resetBodyPadding());b.$broadcast("ngDialog.closed",n)}).addClass("ngdialog-closing")):(t.$destroy(),n.remove(),r===0&&(tt.removeClass("ngdialog-open"),nt.resetBodyPadding()),b.$broadcast("ngDialog.closed",n));c[u]&&(c[u].resolve({id:u,value:i,$dialog:n,remainingDialogs:r}),delete c[u])},closeDialog:function(t,i){var u=t.data("$ngDialogPreCloseCallback"),r;u&&n.isFunction(u)?(r=u.call(t,i),n.isObject(r)?r.closePromise?r.closePromise.then(function(){nt.performCloseDialog(t,i)}):r.then(function(){nt.performCloseDialog(t,i)},function(){return}):r!==!1&&nt.performCloseDialog(t,i)):nt.performCloseDialog(t,i)},onTrapFocusKeydown:function(t){var r=n.element(t.currentTarget),i,u,f;if(r.hasClass("ngdialog"))i=r;else if(i=nt.getActiveDialog(),i===null)return;u=t.keyCode===9;f=t.shiftKey===!0;u&&nt.handleTab(i,t,f)},handleTab:function(n,t,i){var r=nt.getFocusableElements(n);if(r.length===0){document.activeElement&&document.activeElement.blur();return}var o=document.activeElement,u=Array.prototype.indexOf.call(r,o),e=u===-1,s=u===0,h=u===r.length-1,f=!1;i?(e||s)&&(r[r.length-1].focus(),f=!0):(e||h)&&(r[0].focus(),f=!0);f&&(t.preventDefault(),t.stopPropagation())},autoFocus:function(n){var e=n[0],t=e.querySelector("*[autofocus]"),r,u,f;if(t===null||(t.focus(),document.activeElement!==t)){if(r=nt.getFocusableElements(n),r.length>0){r[0].focus();return}u=nt.filterVisibleElements(e.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span"));u.length>0&&(f=u[0],i(f).attr("tabindex","0"),f.focus())}},getFocusableElements:function(n){var t=n[0],i=t.querySelectorAll(h);return nt.filterVisibleElements(i)},filterVisibleElements:function(n){for(var t,r=[],i=0;i<n.length;i++)t=n[i],(t.offsetWidth>0||t.offsetHeight>0)&&r.push(t);return r},getActiveDialog:function(){var n=document.querySelectorAll(".ngdialog");return n.length===0?null:i(n[n.length-1])},applyAriaAttributes:function(n,t){if(t.ariaAuto){if(!t.ariaRole){var i=nt.getFocusableElements(n).length>0?"dialog":"alertdialog";t.ariaRole=i}t.ariaLabelledBySelector||(t.ariaLabelledBySelector="h1,h2,h3,h4,h5,h6");t.ariaDescribedBySelector||(t.ariaDescribedBySelector="article,section,p")}t.ariaRole&&n.attr("role",t.ariaRole);nt.applyAriaAttribute(n,"aria-labelledby",t.ariaLabelledById,t.ariaLabelledBySelector);nt.applyAriaAttribute(n,"aria-describedby",t.ariaDescribedById,t.ariaDescribedBySelector)},applyAriaAttribute:function(n,t,r,u){var o,e,f;return r&&n.attr(t,r),u?(o=n.attr("id"),e=n[0].querySelector(u),!e)?void 0:(f=o+"-"+t,i(e).attr("id",f),n.attr(t,f),f):void 0}},it={open:function(e){function ut(n,t){return w.get(n,t||{}).then(function(n){return n.data||""})}function ft(t){return t?n.isString(t)&&o.plain?t:typeof o.cache=="boolean"&&!o.cache?ut(t,{cache:!1}):v.get(t)||ut(t,{cache:!0}):"Empty template"}var h=this,o=n.copy(l),rt,s,a;return e=e||{},n.extend(o,e),u+=1,h.latestID="ngdialog"+u,c[h.latestID]=rt=p.defer(),t=n.isObject(o.scope)?o.scope.$new():b.$new(),p.when(ft(o.template||o.templateUrl)).then(function(e){var l,p,c,w;if(v.put(o.template||o.templateUrl,e),o.showClose&&(e+='<div class="ngdialog-close"><\/div>'),h.$result=s=i('<div id="ngdialog'+u+'" class="ngdialog"><\/div>'),s.html(o.overlay?'<div class="ngdialog-overlay"><\/div><div class="ngdialog-content" role="document">'+e+"<\/div>":'<div class="ngdialog-content" role="document">'+e+"<\/div>"),s.data("$ngDialogOptions",o),o.data&&n.isString(o.data)?(l=o.data.replace(/^\s*/,"")[0],t.ngDialogData=l==="{"||l==="["?n.fromJson(o.data):o.data):o.data&&n.isObject(o.data)&&(t.ngDialogData=o.data),o.controller&&(n.isString(o.controller)||n.isArray(o.controller)||n.isFunction(o.controller))&&(p=g(o.controller,{$scope:t,$element:s}),s.data("$ngDialogControllerController",p)),o.className&&s.addClass(o.className),a=o.appendTo&&n.isString(o.appendTo)?n.element(document.querySelector(o.appendTo)):tt,nt.applyAriaAttributes(s,o),o.preCloseCallback&&(n.isFunction(o.preCloseCallback)?c=o.preCloseCallback:n.isString(o.preCloseCallback)&&t&&(n.isFunction(t[o.preCloseCallback])?c=t[o.preCloseCallback]:t.$parent&&n.isFunction(t.$parent[o.preCloseCallback])?c=t.$parent[o.preCloseCallback]:b&&n.isFunction(b[o.preCloseCallback])&&(c=b[o.preCloseCallback])),c&&s.data("$ngDialogPreCloseCallback",c)),t.closeThisDialog=function(n){nt.closeDialog(s,n)},k(function(){var r=document.querySelectorAll(".ngdialog"),i,n;nt.deactivateAll(r);y(s)(t);i=d.innerWidth-tt.prop("clientWidth");tt.addClass("ngdialog-open");n=i-(d.innerWidth-tt.prop("clientWidth"));n>0&&nt.setBodyPadding(n);a.append(s);nt.activate(s);o.trapFocus&&nt.autoFocus(s);o.name?b.$broadcast("ngDialog.opened",{dialog:s,name:o.name}):b.$broadcast("ngDialog.opened",s)}),o.closeByEscape&&tt.bind("keydown",nt.onDocumentKeydown),o.closeByNavigation&&b.$on("$locationChangeSuccess",function(){nt.closeDialog(s)}),o.preserveFocus&&s.data("$ngDialogPreviousFocus",document.activeElement),f=function(n){var r=o.closeByDocument?i(n.target).hasClass("ngdialog-overlay"):!1,t=i(n.target).hasClass("ngdialog-close");(r||t)&&it.close(s.attr("id"),t?"$closeButton":"$document")},typeof d.Hammer!="undefined"){w=t.hammerTime=d.Hammer(s[0]);w.on("tap",f)}else s.bind("click",f);return r+=1,it}),{id:"ngdialog"+u,closePromise:rt.promise,close:function(n){nt.closeDialog(s,n)}}},openConfirm:function(t){var u=p.defer(),r={closeByEscape:!1,closeByDocument:!1},f;return n.extend(r,t),r.scope=n.isObject(r.scope)?r.scope.$new():b.$new(),r.scope.confirm=function(n){u.resolve(n);var t=i(document.getElementById(f.id));nt.performCloseDialog(t,n)},f=it.open(r),f.closePromise.then(function(n){return n?u.reject(n.value):u.reject()}),u.promise},close:function(n,t){var r=i(document.getElementById(n));return r.length?nt.closeDialog(r,t):it.closeAll(t),it},closeAll:function(n){for(var u,r=document.querySelectorAll(".ngdialog"),t=r.length;t>-1;t--)u=r[t],nt.closeDialog(i(u),n)},getDefaults:function(){return l}},it}]}),f.directive("ngDialog",["ngDialog",function(t){return{restrict:"A",scope:{ngDialogScope:"="},link:function(i,r,u){r.on("click",function(r){var e,f;r.preventDefault();e=n.isDefined(i.ngDialogScope)?i.ngDialogScope:"noScope";n.isDefined(u.ngDialogClosePrevious)&&t.close(u.ngDialogClosePrevious);f=t.getDefaults();t.open({template:u.ngDialog,className:u.ngDialogClass||f.className,controller:u.ngDialogController,scope:e,data:u.ngDialogData,showClose:u.ngDialogShowClose==="false"?!1:u.ngDialogShowClose==="true"?!0:f.showClose,closeByDocument:u.ngDialogCloseByDocument==="false"?!1:u.ngDialogCloseByDocument==="true"?!0:f.closeByDocument,closeByEscape:u.ngDialogCloseByEscape==="false"?!1:u.ngDialogCloseByEscape==="true"?!0:f.closeByEscape,preCloseCallback:u.ngDialogPreCloseCallback||f.preCloseCallback})})}}}]),f});