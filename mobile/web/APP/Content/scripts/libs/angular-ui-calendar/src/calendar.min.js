angular.module("ui.calendar",[]).constant("uiCalendarConfig",{}).controller("uiCalendarCtrl",["$scope","$timeout",function(n,t){var r=1,u=1,i=n.eventSources,f=n.calendarWatchEvent?n.calendarWatchEvent:angular.noop,e=function(n){var i;return n&&(i=function(){var i=arguments;t(function(){n.apply(this,i)})}),i};this.eventsFingerprint=function(n){return n.__uiCalId||(n.__uiCalId=u++),""+n.__uiCalId+(n.id||"")+(n.title||"")+(n.url||"")+(+n.start||"")+(+n.end||"")+(n.allDay||"")+(n.className||"")+f(n)||""};this.sourcesFingerprint=function(n){return n.__id||(n.__id=r++)};this.allEvents=function(){for(var n,e,t,r,u=[],f=0,o=i.length;f<o;f++)if(n=i[f],angular.isArray(n))u.push(n);else if(angular.isObject(n)&&angular.isArray(n.events)){e={};for(t in n)t!=="_uiCalId"&&t!=="events"&&(e[t]=n[t]);for(r=0;r<n.events.length;r++)angular.extend(n.events[r],e);u.push(n.events)}return Array.prototype.concat.apply([],u)};this.changeWatcher=function(n,t){var i,f=function(){for(var e=angular.isFunction(n)?n():n,o=[],i,u,f=0,s=e.length;f<s;f++)u=e[f],i=t(u),r[i]=u,o.push(i);return o},u=function(n,t){for(var u=[],f={},i=0,r=t.length;i<r;i++)f[t[i]]=!0;for(i=0,r=n.length;i<r;i++)f[n[i]]||u.push(n[i]);return u},r={},e=function(n,f){for(var o,c,v={},y=u(f,n),s,l,a,e=0,h=y.length;e<h;e++)if(s=y[e],o=r[s],delete r[s],l=t(o),l===s)i.onRemoved(o);else{v[l]=s;i.onChanged(o)}for(a=u(n,f),e=0,h=a.length;e<h;e++)if(c=a[e],o=r[c],!v[c])i.onAdded(o)};return i={subscribe:function(n,t){n.$watch(f,function(n,i){t&&t(n,i)===!1||e(n,i)},!0)},onAdded:angular.noop,onChanged:angular.noop,onRemoved:angular.noop}};this.getFullCalendarConfig=function(n,t){var i={};return angular.extend(i,t),angular.extend(i,n),angular.forEach(i,function(n,t){typeof n=="function"&&(i[t]=e(i[t]))}),i}}]).directive("uiCalendar",["uiCalendarConfig","$locale",function(n,t){var i=function(n){var t,i;t=[];for(i in n)t[i]=n[i];return t},r=t.DATETIME_FORMATS;return n=angular.extend({monthNames:i(r.MONTH),monthNamesShort:i(r.SHORTMONTH),dayNames:i(r.DAY),dayNamesShort:i(r.SHORTDAY)},n||{}),{restrict:"A",scope:{eventSources:"=ngModel",calendarWatchEvent:"&"},controller:"uiCalendarCtrl",link:function(t,i,r,u){function c(){var s=r.uiCalendar?t.$parent.$eval(r.uiCalendar):{},o,e,i;o=u.getFullCalendarConfig(s,n);f={eventSources:h};angular.extend(f,o);e={};for(i in f)i!=="eventSources"&&(e[i]=f[i]);return JSON.stringify(e)}var h=t.eventSources,e=!1,s=u.changeWatcher(h,u.sourcesFingerprint),o=u.changeWatcher(u.allEvents,u.eventsFingerprint),f=null;t.destroy=function(){t.calendar=r.calendar?t.$parent[r.calendar]=i.html(""):i.html("")};t.init=function(){t.calendar.fullCalendar(f)};s.onAdded=function(n){t.calendar.fullCalendar("addEventSource",n);e=!0};s.onRemoved=function(n){t.calendar.fullCalendar("removeEventSource",n);e=!0};o.onAdded=function(n){t.calendar.fullCalendar("renderEvent",n)};o.onRemoved=function(n){t.calendar.fullCalendar("removeEvents",function(t){return t===n})};o.onChanged=function(n){t.calendar.fullCalendar("updateEvent",n)};s.subscribe(t);o.subscribe(t,function(){if(e===!0)return e=!1,!1});t.$watch(c,function(){t.destroy();t.init()})}}}]);