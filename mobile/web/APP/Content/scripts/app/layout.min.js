(function(){function p(n){return setTimeout(function(){n.execCommand("autocomplete")},100),CodeMirror.Pass}function h(n){return CodeMirror.showHint(n,CodeMirror.ternHint,{async:!0})}function c(){t("west")}function l(){t("east")}function a(){t("south")}function v(){fullscreenJSMode?(window.theLayout.close("south",!0,!0),window.theLayout.close("east",!0,!0),window.theLayout.close("west",!0,!0)):(window.theLayout.open("south",!1,!0),window.theLayout.open("east",!1,!0),window.theLayout.open("west",!1,!0))}function i(){}function y(){html_editor.refresh();css_editor.refresh();js_editor.refresh()}function t(n,i){var o=i||n,s=window.theLayout,e=s.panes[o],h=s.state,r=h[o],c=h.container,u=null,v=r.outerHeight-r.css.height,y=r.outerWidth-r.css.width,a,f,l;if(o==="north"||o==="south"?e.height()==r.css.height?(e.css({height:c.innerHeight-v,zIndex:3}),u=!0):(e.css({height:r.css.height,zIndex:1}),u=!1):(o==="east"||o==="west")&&(e.width()==r.css.width?(r.top=e.css("top"),e.css({top:c.insetTop,height:c.innerHeight-v,width:c.innerWidth-y,zIndex:3}),u=!0):(e.css({top:r.top,height:r.css.height,width:r.css.width,zIndex:1}),u=!1)),u!==null){for(r.maximized=u,c.maximizedPane=u?o:"",a=0;a<5;a++)(f=$.layout.config.allPanes[a],l=s.panes[f],l&&f!=o)&&(u&&l.is(":visible")?(h[f].hiddenByMaximize=!0,l.css("visibility","hidden"),f!=="center"&&s.resizers[f].hide()):!u&&h[f].hiddenByMaximize&&(h[f].hiddenByMaximize=!1,l.css("visibility","visible"),f!=="center"&&s.resizers[f].show()));u?e.bind("layoutpaneonclose_start.toggleMaximize",t).bind("layoutpaneonresize_start.toggleMaximize",t):(e.unbind(".toggleMaximize"),i||s.resizeAll())}}var u=!0,f,e,o,s,n,r;fullscreenHTMLMode=!1;fullscreenCSSMode=!1;fullscreenJSMode=!1;fullscreenWGTMode=!1;f={name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]};e=$(".page-footer").offset().top-110;$("#codeeditor").css("height",e);$("#codeeditor").removeClass("layout-hide");$("#ribbon").resize(function(){setTimeout(function(){var n=$(".page-footer").offset().top-110;$("#codeeditor").css("height",n-($("#ribbon").offset().left<200?4:0))},50)});window.html_editor=CodeMirror.fromTextArea($("#code-html textarea")[0],{lineNumbers:!0,tabMode:"indent",mode:f,styleActiveLine:!0,dragDrop:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],keyMap:"sublime",autoCloseBrackets:!0,matchBrackets:!0,showCursorWhenSelecting:!0,theme:"monokai"});o=new CodeCompletion(html_editor,new HtmlCompletion);html_editor.setOption("onKeyEvent",function(n,t){return console.log(t),o.handleKeyEvent(n,t)});$("[name=btntabs]").on("change",function(n){var t="#content-"+n.currentTarget.id;$(".widget-group").hide();$(t).show()});window.css_editor=CodeMirror.fromTextArea($("#code-css textarea")[0],{lineNumbers:!0,tabMode:"indent",styleActiveLine:!0,keyMap:"sublime",autoCloseBrackets:!0,matchBrackets:!0,showCursorWhenSelecting:!0,theme:"monokai",dragDrop:!0,mode:"css",foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"]});s=new CodeCompletion(css_editor,new CssCompletion);css_editor.setOption("onKeyEvent",function(n,t){return s.handleKeyEvent(n,t)});window.cfg_editor=CodeMirror.fromTextArea($("#content-optData textarea")[0],{lineNumbers:!0,tabMode:"indent",styleActiveLine:!0,keyMap:"sublime",autoCloseBrackets:!0,matchBrackets:!0,showCursorWhenSelecting:!0,dragDrop:!0,extraKeys:{"Ctrl-Space":"autocomplete"},mode:{name:"javascript",globalVars:!0},foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"]});CodeMirror.commands.autocomplete=function(n){CodeMirror.showHint(n,h)};n=new CodeMirror.TernServer;window.js_editor=CodeMirror.fromTextArea($("#code-js textarea")[0],{lineNumbers:!0,tabMode:"indent",styleActiveLine:!0,keyMap:"sublime",autoCloseBrackets:!0,matchBrackets:!0,showCursorWhenSelecting:!0,theme:"monokai",dragDrop:!0,extraKeys:{"'.'":p,"Ctrl-Space":function(t){n.complete(t)},"Ctrl-I":function(t){n.showType(t)},"Ctrl-O":function(t){n.showDocs(t)},"Alt-.":function(t){n.jumpToDef(t)},"Alt-,":function(t){n.jumpBack(t)},"Ctrl-Q":function(t){n.rename(t)},"Ctrl-.":function(t){n.selectName(t)}},mode:{name:"javascript",globalVars:!0},foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],lintWith:CodeMirror.javascriptValidator,textHover:{delay:300},onKeyEvent:function(n,t){t.type=="keyup"&&(t.keyCode>=65&&t.keyCode<=90||t.keyCode==190)&&CodeMirror.showHint(n,h)}});window.js_editor.on("cursorActivity",function(t){n.updateArgHints(t)});html_editor.on("focus",function(){$(".html-logo").fadeOut("slow")});html_editor.on("blur",function(){$(".html-logo").fadeIn("slow")});html_editor.on("change",function(){i()});css_editor.on("focus",function(){$(".css-logo").fadeOut("slow")});css_editor.on("blur",function(){$(".css-logo").fadeIn("slow")});css_editor.on("change",function(){i()});js_editor.on("focus",function(){$(".js-logo").fadeOut("slow")});js_editor.on("blur",function(){$(".js-logo").fadeIn("slow")});js_editor.on("change",function(){i()});$("#fullscreen-html-toggle").on("click",function(){fullscreenHTMLMode?(fullscreenHTMLMode=!1,$("#fullscreen-html").removeClass("fullscreen-small-exit"),$("#fullscreen-html").addClass("fullscreen-small"),c(),$(".layout").fadeIn()):(c(),fullscreenHTMLMode=!0,$("#fullscreen-html").removeClass("fullscreen-small"),$("#fullscreen-html").addClass("fullscreen-small-exit"),$(".layout").fadeOut())});$("#fullscreen-css-toggle").on("click",function(){fullscreenCSSMode?(fullscreenCSSMode=!1,$("#fullscreen-css").removeClass("fullscreen-small-exit"),$("#fullscreen-css").addClass("fullscreen-small"),l(),$(".layout").fadeIn()):(l(),fullscreenCSSMode=!0,$("#fullscreen-css").removeClass("fullscreen-small"),$("#fullscreen-css").addClass("fullscreen-small-exit"),$(".layout").fadeOut())});$("#fullscreen-js-toggle").on("click",function(){fullscreenJSMode?(fullscreenJSMode=!1,$("#fullscreen-js").removeClass("fullscreen-small-exit"),$("#fullscreen-js").addClass("fullscreen-small"),v(),$(".layout").fadeIn()):(fullscreenJSMode=!0,v(),$("#fullscreen-js").removeClass("fullscreen-small"),$("#fullscreen-js").addClass("fullscreen-small-exit"),$(".layout").fadeOut())});$("#fullscreen-wgt-toggle").on("click",function(){fullscreenWGTMode?(fullscreenWGTMode=!1,$("#fullscreen-css").removeClass("fullscreen-small-exit"),$("#fullscreen-css").addClass("fullscreen-small"),a(),$(".layout").fadeIn()):(a(),fullscreenWGTMode=!0,$("#fullscreen-css").removeClass("fullscreen-small"),$("#fullscreen-css").addClass("fullscreen-small-exit"),$(".layout").fadeOut())});window.theLayout=$("#codeeditor").layout();$.each($.layout.config.borderPanes,function(n,t){var i=theLayout.options[t];i.livePaneResizing=!i.livePaneResizing});$(document).on("mousedown",".ui-layout-resizer",function(){$("<div class='victim_overlay'><\/div>").appendTo("#result")});$(document).on("mouseup",".ui-layout-resizer",function(){$(".victim_overlay").remove();y()});$(document).on("mouseup",".ui-draggable-dragging",function(){$(".victim_overlay").remove();y()});u=!u;$("#btn-load-schema").on("click",function(){var n=$("#search-fld").val();$.ajax({url:"appconfig/system/infodetail?id="+n}).done(function(t){html_editor.setValue(t.form);js_editor.setValue(t.column);cfg_editor.setValue(t.field);toastr.success("Load schema : "+n+" done !!!","Success")})});$("#btn-save-editor").on("click",function(n){var t=html_editor.getValue(),i=css_editor.getValue(),r=js_editor.getValue(),u=cfg_editor.getValue(),f=$("#search-fld").val();n.preventDefault();bootbox.confirm("Are you sure?",function(n){if(n==!0){var e={html:t,css:i,js:r,cfg:u,filename:f};$.ajax({type:"POST",url:"api/config/savecontent",data:e}).done(function(n){toastr.success("Data has been saved with Id: "+n,"Success")})}})});if("onhashchange"in window){function w(){var n=location.hash.substring(1);$("#search-fld").val(n);r()}window.onhashchange=w;window.theLayout.close("east",!0,!0);window.theLayout.close("south",!0,!0)}$("#search-fld").keypress(function(n){var t=n.keyCode?n.keyCode:n.which;t=="13"&&r()});r=function(){var n=$("#search-fld").val(),t={filename:n};$.ajax({type:"GET",url:"appengine/loadcontent",data:t}).done(function(n){js_editor.setValue("");css_editor.setValue("");cfg_editor.setValue("");html_editor.setValue("");n.success==!0&&n.data!==null&&(js_editor.setValue(n.data.js||""),css_editor.setValue(n.data.css||""),cfg_editor.setValue(n.data.cfg||""),html_editor.setValue(n.data.html||""))})}})();